<!DOCTYPE html><html lang="zh-cn" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>OpenLayers | HeavenImmortal</title><meta name="keywords" content="前端 javaScript WebGis"><meta name="author" content="HeavenImmortal,1909312602@qq.com"><meta name="copyright" content="HeavenImmortal"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><meta name="description" content="本人学习OpenLayers的记录">
<meta property="og:type" content="article">
<meta property="og:title" content="OpenLayers">
<meta property="og:url" content="https://heavenimtoral.gitee.io/2021/09/22/OpenLayers/index.html">
<meta property="og:site_name" content="HeavenImmortal">
<meta property="og:description" content="本人学习OpenLayers的记录">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152509.png">
<meta property="article:published_time" content="2021-09-22T06:27:41.751Z">
<meta property="article:modified_time" content="2021-09-24T02:01:02.827Z">
<meta property="article:author" content="HeavenImmortal">
<meta property="article:tag" content="WebGis">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152509.png"><link rel="shortcut icon" href="/img/favicon.png"><link rel="canonical" href="https://heavenimtoral.gitee.io/2021/09/22/OpenLayers/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"We didn't find any results for the search: ${query}"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: 'days',
  date_suffix: {
    just: 'Just',
    min: 'minutes ago',
    hour: 'hours ago',
    day: 'days ago',
    month: 'months ago'
  },
  copyright: {"limitCount":50,"languages":{"author":"Author: HeavenImmortal","link":"Link: ","source":"Source: HeavenImmortal","info":"Copyright is owned by the author. For commercial reprints, please contact the author for authorization. For non-commercial reprints, please indicate the source."}},
  ClickShowText: undefined,
  lightbox: 'fancybox',
  Snackbar: undefined,
  justifiedGallery: {
    js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
    css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
  },
  isPhotoFigcaption: true,
  islazyload: false,
  isanchor: true
};

var saveToLocal = {
  set: function setWithExpiry(key, value, ttl) {
    const now = new Date()
    const expiryDay = ttl * 86400000
    const item = {
      value: value,
      expiry: now.getTime() + expiryDay,
    }
    localStorage.setItem(key, JSON.stringify(item))
  },

  get: function getWithExpiry(key) {
    const itemStr = localStorage.getItem(key)

    if (!itemStr) {
      return undefined
    }
    const item = JSON.parse(itemStr)
    const now = new Date()

    if (now.getTime() > item.expiry) {
      localStorage.removeItem(key)
      return undefined
    }
    return item.value
  }
}</script><script id="config_change">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2021-09-24 10:01:02'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(function () {  window.activateDarkMode = function () {
    document.documentElement.setAttribute('data-theme', 'dark')
    if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
    }
  }
  window.activateLightMode = function () {
    document.documentElement.setAttribute('data-theme', 'light')
   if (document.querySelector('meta[name="theme-color"]') !== null) {
      document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
    }
  }
  const autoChangeMode = 'false'
  const t = saveToLocal.get('theme')
  if (autoChangeMode === '1') {
    const isDarkMode = window.matchMedia('(prefers-color-scheme: dark)').matches
    const isLightMode = window.matchMedia('(prefers-color-scheme: light)').matches
    const isNotSpecified = window.matchMedia('(prefers-color-scheme: no-preference)').matches
    const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified
    if (t === undefined) {
      if (isLightMode) activateLightMode()
      else if (isDarkMode) activateDarkMode()
      else if (isNotSpecified || hasNoSupport) {
        const now = new Date()
        const hour = now.getHours()
        const isNight = hour <= 6 || hour >= 18
        isNight ? activateDarkMode() : activateLightMode()
      }
      window.matchMedia('(prefers-color-scheme: dark)').addListener(function (e) {
        if (saveToLocal.get('theme') === undefined) {
          e.matches ? activateDarkMode() : activateLightMode()
        }
      })
    } else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else if (autoChangeMode === '2') {
    const now = new Date()
    const hour = now.getHours()
    const isNight = hour <= 6 || hour >= 18
    if (t === undefined) isNight ? activateDarkMode() : activateLightMode()
    else if (t === 'light') activateLightMode()
    else activateDarkMode()
  } else {
    if (t === 'dark') activateDarkMode()
    else if (t === 'light') activateLightMode()
  }const asideStatus = saveToLocal.get('aside-status')
if (asideStatus !== undefined) {
   if (asideStatus === 'hide') {
     document.documentElement.classList.add('hide-aside')
   } else {
     document.documentElement.classList.remove('hide-aside')
   }
}})()</script><link rel="stylesheet" href="/css/mine.css"><meta name="generator" content="Hexo 5.2.0"><link rel="alternate" href="/atom.xml" title="HeavenImmortal" type="application/atom+xml">
</head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">Loading...</div></div></div><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/avatar.png" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">44</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">40</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-link"></i><span> 链接</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></li></ul></div></div></div></div><div id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url(https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152509.png)"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">HeavenImmortal</a></span><span id="menus"><div id="search_button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> Search</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page" href="/messageboard/"><i class="fa-fw fa fa-paper-plane"></i><span> 留言板</span></a></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa-fw fa fa-book"></i><span> 找文章</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page" href="/categories/"><i class="fa-fw fa fa-folder-open"></i><span> 分类</span></a></li><li><a class="site-page" href="/archives/"><i class="fa-fw fa fa-archive"></i><span> 时间轴</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-link"></i><span> 链接</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/link/"><i class="fa-fw fa fa-users"></i><span> 友情链接</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="javascript:void(0);"><i class="fa-fw fa fa-list"></i><span> 菜单</span><i class="fas fa-chevron-down expand"></i></a><ul class="menus_item_child"><li><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 关于</span></a></li></ul></div></div><span class="close" id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></span></span></nav><div id="post-info"><h1 class="post-title">OpenLayers</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">Created</span><time class="post-meta-date-created" datetime="2021-09-22T06:27:41.751Z" title="Created 2021-09-22 14:27:41">2021-09-22</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">Updated</span><time class="post-meta-date-updated" datetime="2021-09-24T02:01:02.827Z" title="Updated 2021-09-24 10:01:02">2021-09-24</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/javaScript/">javaScript</a></span></div><div class="meta-secondline"> <span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">Word count:</span><span class="word-count">27.6k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">Reading time:</span><span>103min</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">Post View:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h1 id="前言"><a href="#前言" class="headerlink" title="前言"></a>前言</h1><p><a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_35732147/article/details/90675012">参考博客</a></p>
<h2 id="介绍"><a href="#介绍" class="headerlink" title="介绍"></a>介绍</h2><h3 id="介绍-1"><a href="#介绍-1" class="headerlink" title="介绍"></a>介绍</h3><p>OpenLayers是一个用于开发WebGIS客户端的JavaScript包，最初基于BSD许可发行。</p>
<p>OpenLayers是一个开源的项目，其设计之意是为互联网客户端提供强大的地图展示功能，包括地图数据显示与相关操作，并具有灵活的扩展机制。</p>
<p>目前OpenLayers已经成为一个拥有众多开发者和帮助社区的成熟、流行的框架。</p>
<h3 id="特征"><a href="#特征" class="headerlink" title="特征"></a>特征</h3><ul>
<li>支持瓦片图层</li>
</ul>
<p>OpenLayers支持从OSM、Bing、MapBox、Stamen和其他任何你能找到的XYZ瓦片资源中提取地图瓦片并在前端展示。同时也支持OGC的WMTS规范的瓦片服务以及ArcGIS规范的瓦片服务。</p>
<ul>
<li>支持矢量切片（或者矢量瓦片）</li>
</ul>
<p>OpenLayers也支持矢量切片的访问和展示，包括MapBox矢量切片中的pbf格式，或者GeoJSON格式和TopoJSON格式的矢量切片。</p>
<ul>
<li>支持矢量图层</li>
</ul>
<p>能够渲染GeoJSON、TopoJSON、KML、GML和其他格式的矢量数据，上面说的矢量切片形式的数据也可以被认为是在矢量图层中渲染。</p>
<ul>
<li>支持OGC规范</li>
</ul>
<p>OpenLayers支持OGC制定的WMS、WFS等GIS网络服务规范。</p>
<ul>
<li>运用前沿技术</li>
</ul>
<p>利用Canvas 2D、WebGL以及HTML5中其他最新的技术来构建功能。同时支持在移动设备上运行。</p>
<ul>
<li>易于定制和扩展</li>
</ul>
<p>可以直接调整CSS来为地图控件设计样式。而且可以对接到不同层级的API进行功能扩展，或者使用第三方库来定制和扩展。</p>
<ul>
<li>面向对象的思想</li>
</ul>
<p>最新版本的OpenLayers采用纯面向对象的ECMA Script 6进行开发，可以说，在OpenLayers中万物皆对象。</p>
<ul>
<li>优秀的交互体验</li>
</ul>
<p>OpenLayers实现了类似于Ajax的无刷新功能，可以结合很多优秀的JavaScript功能插件，带给用户更多丰富的交互体验。</p>
<h3 id="框架结构"><a href="#框架结构" class="headerlink" title="框架结构"></a>框架结构</h3><p><img src="E:\typora\images\20210917151257.jpg" alt="img"></p>
<p>可以看到OpenLayers实现了上百个类，用于对GIS中的各种事物进行抽象表达。</p>
<p>其中，Map、Layer、Source和View是OpenLayers框架体系中的核心类，几乎所有的动作都围绕这几个核心类展开，以实现地图加载和相关操作。</p>
<p>在OpenLayers的体系框架中：把整个地图看作一个容器（Map），核心为地图图层（Layer），每个图层有对应的数据源（Source），并由地图视图（View）进行地图表现。地图容器上还支持一些与用户交互的控件（Control和Interaction），另外，OpenLayers还支持事件机制。</p>
<h3 id="基本类介绍"><a href="#基本类介绍" class="headerlink" title="基本类介绍"></a>基本类介绍</h3><ul>
<li><strong>Map</strong><br>地图容器，必要属性layers，view，target。</li>
<li>View<br>可以说是地图的视角，它可以控制地图的中心和级别等其他属性。</li>
<li><strong>Layer和Source</strong><br>首先需要明白的一点是，Source和Layer是一对一的关系，有一个Source，必然需要一个Layer，然后把这个Layer添加到Map上，就可以显示出来了。</li>
</ul>
<h1 id="下载安装"><a href="#下载安装" class="headerlink" title="下载安装"></a>下载安装</h1><p><a target="_blank" rel="noopener" href="https://openlayers.org/">openLayers官网</a></p>
<h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a>下载</h2><p>1、进入官网下载</p>
<p><img src="E:\typora\images\20210916203503.png" alt="image-20210916203500551"></p>
<figure class="highlight txt"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install ol 是在具有node.js环境中下载</span><br><span class="line">dist后缀的压缩包 是进行过代码压缩过的</span><br></pre></td></tr></table></figure>

<p><img src="E:\typora\images\20210916203612.png" alt="image-20210916203609938"></p>
<p>2、解压，build下的ol.js和css下的ol.css是我们后面要用的的文件</p>
<p><img src="E:\typora\images\20210918091353.png" alt="image-20210918091255213"></p>
<p><img src="E:\typora\images\20210918091347.png" alt="image-20210918091318944"></p>
<p><img src="E:\typora\images\20210918091350.png" alt="image-20210918091340085"></p>
<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><h2 id="构建简单的地图应用"><a href="#构建简单的地图应用" class="headerlink" title="构建简单的地图应用"></a>构建简单的地图应用</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>构建简单的地图<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>关于上面的代码，我们做了哪些事</p>
</blockquote>
<ol>
<li>调用ol.Map生成的地图容器map，并使用target属性将该地图容器与id为‘map’的div容器关联起来</li>
<li>通过layers参数设置的需要加载的瓦片图层（ol.layer.Tile），这个瓦片图层中包含了一个数据源（ol.source.OSM），这个数据源是OpenStreetMap（一个开放数据源的免费地图）的地图数据，也就是ol.source.OSM这个类封装了加载OSM地图数据的详细实现。</li>
<li>通过view设置地图视图（ol.View），地图视图中也设置了相应的空间参考系统（projection）、地图视图中心点（center），地图视图缩放级别（zoom）。</li>
</ol>
<p><img src="E:\typora\images\20210918091512.png" alt="image-20210918091511152"></p>
<blockquote>
<p>被渲染后的div容器</p>
</blockquote>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152722.png" alt="image-20210918095535410"></p>
<p>我们可以看见div容器被渲染后，分成的3个层级</p>
<ul>
<li><p>ol-unselectable</p>
<p>地图渲染层，地图基于canvas方式渲染</p>
</li>
<li><p>ol-overlaycontainer</p>
<p>内容叠加层，用于放置叠置层（ol.Overlay）内容，如在地图上添加图片、弹窗等</p>
</li>
<li><p>ol-overlaycontainer-stopevent</p>
<p>地图控件层，用于放置控件，默认情况下会放置ol.control.Zoom（用于控制地图放大、缩小）、ol.control.Rotate（用于控制地图旋转）、ol.control.Attribution（用于控制地图右下角标记）这三个控件。</p>
</li>
</ul>
<h2 id="控件"><a href="#控件" class="headerlink" title="控件"></a>控件</h2><p>OpenLayers封装了很多控件用于对地图进行操作、显示地图信息等。</p>
<p>具体来说，控件是一个地图上可见的小部件，其DOM元素位于屏幕上的固定位置。它们可以包含用户输入（以按钮的形式），也可以只提供信息。控件的位置是使用CSS来确定，当然也可以使用CSS来调整。默认情况下，控件被放置在地图控件层，也就是CSS类名为ol-overlayContainer-stopEvent的元素中，但也可以调整，使控件基于外部DOM元素来实现。</p>
<p>从OpenLayers的API来看，具体有如下控件类：<img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152728.png" alt="img"></p>
<p>具体来说，这些控件是干嘛的呢？这里简单介绍一下</p>
<ul>
<li>归属控件（Attribution）    ——    用于展示地图资源的版权或者归属，它会默认加入到地图中。</li>
<li>全屏控件（FullScreen）    ——    控制地图全屏展示</li>
<li>坐标拾取控件（MousePosition）    ——    用于在地图上拾取坐标</li>
<li>鹰眼控件（OverviewMap）    ——    生成地图的一个概览图</li>
<li>旋转控件（Rotate）    ——    用于鼠标拖拽旋转地图，它会默认加入到地图中。</li>
<li>比例尺控件（ScaleLine）    ——    用于生成地图比例尺</li>
<li>滑块缩放控件（ZoomSlider）    ——    以滑块的形式缩放地图</li>
<li>缩放至特定位置控件（ZoomToExtent）    ——    用于将地图视图缩放至特定位置</li>
<li>普通缩放控件（Zoom）    ——    普通缩放控件，它会默认加入到地图中。</li>
</ul>
<h3 id="zoom控件"><a href="#zoom控件" class="headerlink" title="zoom控件"></a>zoom控件</h3><h4 id="基本信息"><a href="#基本信息" class="headerlink" title="基本信息"></a>基本信息</h4><p>我们将上一点完成的html文件复制成zoom.html文件。运行起来后</p>
<p>缩放控件、旋转控件、归属控件默认加入地图容器中。</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152733.png" alt="image-20210918101010562"></p>
<p>我们在console中输入**map.getControls().getArray()**，可以拿到该地图容器的控件数组，第一个就是缩放控件。</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152737.png" alt="image-20210918101351729"></p>
<p>而在地图控件层中，缩放控件已在里面</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152741.png" alt="image-20210918101500713"></p>
<blockquote>
<p>zoomAPI</p>
</blockquote>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152745.png" alt="image-20210918102950836"></p>
<h4 id="滑块缩放控件（ol-control-ZoomSlider）与缩放至特定地点控件（ol-control-ZoomToExtent）"><a href="#滑块缩放控件（ol-control-ZoomSlider）与缩放至特定地点控件（ol-control-ZoomToExtent）" class="headerlink" title="滑块缩放控件（ol.control.ZoomSlider）与缩放至特定地点控件（ol.control.ZoomToExtent）"></a>滑块缩放控件（ol.control.ZoomSlider）与缩放至特定地点控件（ol.control.ZoomToExtent）</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>zoom<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.control.ZoomSlider(),</span></span><br><span class="line"><span class="javascript">           <span class="comment">//缩放至特定地点控件</span></span></span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.control.ZoomToExtent(&#123;           <span class="comment">// 缩放至特定位置控件      </span></span></span><br><span class="line">          extent: [</span><br><span class="line"><span class="javascript">            <span class="comment">//前两个元素表示位置矩形的左下角坐标，后两个元素表示位置矩形的右上角坐标,该点坐标是深圳市</span></span></span><br><span class="line">            12667718, 2562800,</span><br><span class="line">            12718359, 2597725</span><br><span class="line">          ]</span><br><span class="line">        &#125;)</span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>滑块缩放上面的E是缩放到特定地点的控价，由于设置成深圳市，点击E之后会跳到深圳市</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152751.png" alt="image-20210918104832208"></p>
<h4 id="归属控件与全屏控件"><a href="#归属控件与全屏控件" class="headerlink" title="归属控件与全屏控件"></a>归属控件与全屏控件</h4><h5 id="归属控件"><a href="#归属控件" class="headerlink" title="归属控件"></a>归属控件</h5><p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152756.png" alt="image-20210918105446350"></p>
<h5 id="全屏控件（ol-control-FullScreen）"><a href="#全屏控件（ol-control-FullScreen）" class="headerlink" title="全屏控件（ol.control.FullScreen）"></a>全屏控件（ol.control.FullScreen）</h5><p>一般情况下，我们的地图只在浏览器的客户区进行展示，我们可以通过全屏控件让地图进行全屏展示</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152800.png" alt="image-20210918105629073"></p>
<p>我们将上一节的zoom.html复制成一份新文件，我们只需要在控件层中加入 <strong>new ol.control.FullScreen()</strong></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>全屏控件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomSlider(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//缩放至特定地点控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomToExtent(&#123;           <span class="comment">// 缩放至特定位置控件      </span></span></span><br><span class="line">          extent: [</span><br><span class="line"><span class="javascript">            <span class="comment">//前两个元素表示位置矩形的左下角坐标，后两个元素表示位置矩形的右上角坐标,该点坐标是深圳市</span></span></span><br><span class="line">            12667718, 2562800,</span><br><span class="line">            12718359, 2597725</span><br><span class="line">          ]</span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="comment">//全屏控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.FullScreen()</span></span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>



<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152806.png" alt="image-20210918110122511"></p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152810.png" alt="image-20210918110137149"></p>
<h4 id="坐标拾取控件与鹰眼控件"><a href="#坐标拾取控件与鹰眼控件" class="headerlink" title="坐标拾取控件与鹰眼控件"></a>坐标拾取控件与鹰眼控件</h4><h5 id="坐标拾取（ol-control-MousePosition-）"><a href="#坐标拾取（ol-control-MousePosition-）" class="headerlink" title="坐标拾取（ol.control.MousePosition()）"></a>坐标拾取（ol.control.MousePosition()）</h5><p>很多时候我们想要实时获取鼠标光标指示处对应的坐标，就像高德地图的坐标拾取</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152813.png" alt="image-20210918110402870"></p>
<p> OpenLayers提供的ol.control.MousePosition类也能够实现坐标拾取功能。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>坐标拾取控件与鹰眼控件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomSlider(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//缩放至特定地点控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomToExtent(&#123;           <span class="comment">// 缩放至特定位置控件      </span></span></span><br><span class="line">          extent: [</span><br><span class="line"><span class="javascript">            <span class="comment">//前两个元素表示位置矩形的左下角坐标，后两个元素表示位置矩形的右上角坐标,该点坐标是深圳市</span></span></span><br><span class="line">            12667718, 2562800,</span><br><span class="line">            12718359, 2597725</span><br><span class="line">          ]</span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="comment">//全屏控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.FullScreen(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//坐标拾取控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.MousePosition() </span></span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152818.png"></p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152821.png" alt="image-20210918110647785"></p>
<h5 id="鹰眼控件-ol-control-OverviewMap"><a href="#鹰眼控件-ol-control-OverviewMap" class="headerlink" title="鹰眼控件(ol.control.OverviewMap())"></a>鹰眼控件(ol.control.OverviewMap())</h5><p>鹰眼图是GIS中的一个基本的功能，鹰眼图，顾名思义，在鹰眼图上可以像从空中俯视一样查看地图框中所显示的地图在整个图中的位置。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>坐标拾取控件与鹰眼控件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomSlider(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//缩放至特定地点控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomToExtent(&#123;           <span class="comment">// 缩放至特定位置控件      </span></span></span><br><span class="line">          extent: [</span><br><span class="line"><span class="javascript">            <span class="comment">//前两个元素表示位置矩形的左下角坐标，后两个元素表示位置矩形的右上角坐标,该点坐标是深圳市</span></span></span><br><span class="line">            12667718, 2562800,</span><br><span class="line">            12718359, 2597725</span><br><span class="line">          ]</span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="comment">//全屏控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.FullScreen(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//坐标拾取控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.MousePosition(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//鹰眼控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.OverviewMap(&#123;        <span class="comment">// 实例化一个OverviewMap类的对象，并加入到地图中</span></span></span><br><span class="line"><span class="javascript">          collapsed: <span class="literal">false</span></span></span><br><span class="line">        &#125;)       </span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152826.png" alt="image-20210918110938565"></p>
<h4 id="旋转控件与比例尺控件"><a href="#旋转控件与比例尺控件" class="headerlink" title="旋转控件与比例尺控件"></a>旋转控件与比例尺控件</h4><h5 id="旋转控件"><a href="#旋转控件" class="headerlink" title="旋转控件"></a>旋转控件</h5><p>旋转控件默认加入map容器的控件层</p>
<p>按住Shift+Alt，再用鼠标移动，就可以旋转。</p>
<p>旋转前</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152829.png" alt="image-20210918111932902"></p>
<p>旋转后</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152833.png" alt="image-20210918111959574"></p>
<h5 id="比例尺控件（ol-control-ScaleLine-）"><a href="#比例尺控件（ol-control-ScaleLine-）" class="headerlink" title="比例尺控件（ol.control.ScaleLine()）"></a>比例尺控件（ol.control.ScaleLine()）</h5><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>旋转控件与比例尺控件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomSlider(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//缩放至特定地点控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomToExtent(&#123;           <span class="comment">// 缩放至特定位置控件      </span></span></span><br><span class="line">          extent: [</span><br><span class="line"><span class="javascript">            <span class="comment">//前两个元素表示位置矩形的左下角坐标，后两个元素表示位置矩形的右上角坐标,该点坐标是深圳市</span></span></span><br><span class="line">            12667718, 2562800,</span><br><span class="line">            12718359, 2597725</span><br><span class="line">          ]</span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="comment">//全屏控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.FullScreen(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//坐标拾取控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.MousePosition(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//鹰眼控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.OverviewMap(&#123;        <span class="comment">// 实例化一个OverviewMap类的对象，并加入到地图中</span></span></span><br><span class="line"><span class="javascript">          collapsed: <span class="literal">false</span></span></span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ScaleLine()      </span></span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152837.png" alt="image-20210918112151277"></p>
<p>可以发现，这里比例尺控件使用的单位是km，如果想使用其他单位，可以修改ScaleLine类中的units属性。</p>
<p> units属性接受”degrees”、”imperial”、”us”、”nautical”或”metric”（默认为”metric”)。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.control.ScaleLine(&#123;</span><br><span class="line">	units:<span class="string">&#x27;degrees&#x27;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152841.png" alt="image-20210918112359349"></p>
<h4 id="自定义切换图层控件"><a href="#自定义切换图层控件" class="headerlink" title="自定义切换图层控件"></a>自定义切换图层控件</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>自定义切换图层控件<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;controls&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;osm&quot;</span> <span class="attr">checked</span> /&gt;</span>OpenStreetMap</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;bingmap&quot;</span> /&gt;</span>Bing Map</span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">id</span>=<span class="string">&quot;stamen&quot;</span> /&gt;</span>Stamen Map</span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;),</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 <span class="comment">// Bing Map图层</span></span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.BingMaps(&#123;</span></span><br><span class="line"><span class="javascript">                  key: <span class="string">&#x27;AgpZJo9V53etmuVovrsSv2Aev6CjrdshpbxSyOCQ9DQpXlLdynagW7Wxhr52WdRB&#x27;</span>,<span class="comment">// 可以自行到Bing Map官网申请key</span></span></span><br><span class="line"><span class="javascript">                  imagerySet: <span class="string">&#x27;Aerial&#x27;</span></span></span><br><span class="line">              &#125;),</span><br><span class="line"><span class="javascript">              visible: <span class="literal">false</span>                  <span class="comment">// 先隐藏该图层</span></span></span><br><span class="line">          &#125;),</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;</span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.Stamen(&#123;</span></span><br><span class="line"><span class="javascript">                  layer: <span class="string">&#x27;watercolor&#x27;</span></span></span><br><span class="line">              &#125;),</span><br><span class="line"><span class="javascript">              visible: <span class="literal">false</span>                  <span class="comment">// 先隐藏该图层</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomSlider(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//缩放至特定地点控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomToExtent(&#123;           <span class="comment">// 缩放至特定位置控件      </span></span></span><br><span class="line">          extent: [</span><br><span class="line"><span class="javascript">            <span class="comment">//前两个元素表示位置矩形的左下角坐标，后两个元素表示位置矩形的右上角坐标,该点坐标是深圳市</span></span></span><br><span class="line">            12667718, 2562800,</span><br><span class="line">            12718359, 2597725</span><br><span class="line">          ]</span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="comment">//全屏控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.FullScreen(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//坐标拾取控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.MousePosition(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//鹰眼控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.OverviewMap(&#123;        <span class="comment">// 实例化一个OverviewMap类的对象，并加入到地图中</span></span></span><br><span class="line"><span class="javascript">          collapsed: <span class="literal">false</span></span></span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ScaleLine(&#123;</span></span><br><span class="line"><span class="javascript">          units:<span class="string">&#x27;degrees&#x27;</span></span></span><br><span class="line">        &#125;)      </span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> controls = <span class="built_in">document</span>.getElementById(<span class="string">&#x27;controls&#x27;</span>);     </span></span><br><span class="line"><span class="javascript">        <span class="comment">// 事件委托</span></span></span><br><span class="line"><span class="javascript">        controls.addEventListener(<span class="string">&#x27;click&#x27;</span>, <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(event.target.checked)&#123;                       <span class="comment">// 如果选中某一复选框</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// 通过DOM元素的id值来判断应该对哪个图层进行显示</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">switch</span>(event.target.id)&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">case</span> <span class="string">&quot;osm&quot;</span>: </span></span><br><span class="line"><span class="javascript">                        map.getLayers().item(<span class="number">0</span>).setVisible(<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">case</span> <span class="string">&quot;bingmap&quot;</span>:</span></span><br><span class="line"><span class="javascript">                        map.getLayers().item(<span class="number">1</span>).setVisible(<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">case</span> <span class="string">&quot;stamen&quot;</span>: </span></span><br><span class="line"><span class="javascript">                        map.getLayers().item(<span class="number">2</span>).setVisible(<span class="literal">true</span>);</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">default</span>: <span class="keyword">break</span>;</span></span><br><span class="line">                &#125;</span><br><span class="line"><span class="javascript">            &#125;<span class="keyword">else</span>&#123;                                         <span class="comment">// 如果取消某一复选框</span></span></span><br><span class="line"><span class="javascript">                <span class="comment">// 通过DOM元素的id值来判断应该对哪个图层进行隐藏</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">switch</span>(event.target.id)&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">case</span> <span class="string">&quot;osm&quot;</span>: </span></span><br><span class="line"><span class="javascript">                        map.getLayers().item(<span class="number">0</span>).setVisible(<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">                        <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">case</span> <span class="string">&quot;bingmap&quot;</span>:</span></span><br><span class="line"><span class="javascript">                        map.getLayers().item(<span class="number">1</span>).setVisible(<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">case</span> <span class="string">&quot;stamen&quot;</span>: </span></span><br><span class="line"><span class="javascript">                        map.getLayers().item(<span class="number">2</span>).setVisible(<span class="literal">false</span>);</span></span><br><span class="line"><span class="javascript">                    <span class="keyword">default</span>: <span class="keyword">break</span>;</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125; </span><br><span class="line">        &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152846.png" alt="image-20210918142333522"></p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152903.png" alt="image-20210918142346157"></p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152908.png" alt="image-20210918142404494"></p>
<p>在以上的代码中，我们通过**map.getLayers().item(0).setVisible(true)**来设置当前展示图层</p>
<p>visible就是控制图层显示的属性</p>
<h2 id="多源数据"><a href="#多源数据" class="headerlink" title="多源数据"></a>多源数据</h2><h3 id="数据组织"><a href="#数据组织" class="headerlink" title="数据组织"></a>数据组织</h3><p>数据是GIS的血液，可以说GIS应用系统的几乎所有活动与行为都围绕数据展开。那么在GIS对数据加载、存储、分析与操作这几个过程中，我们首先讨论在由OpenLayers构建的WebGIS系统中，数据如何合理加载。    </p>
<p>随着WebGIS应用的不断发展，目前出现了大量网络地图服务资源，包括国外互联网公司的Google地图、Bing 地图、Yahoo 地图，国外的开源地图OpenStreetMap，也包括国内互联网公司的百度地图、高德地图、腾讯地图。还有ESRI、超图、中地数码等大型GIS厂商提供的自定格式的GIS数据，以及其他企事业单位或研究机构提供的各种格式的GIS数据等。如何将这些多源异构数据加载到Web客户端中进行显示，实现数据无缝融合，这是WebGIS中需要首先解决的关键问题。</p>
<p>OpenLayers的地图数据通过图层（Layer）进行组织渲染，然后通过数据源（Source）设置具体的地图数据来源。</p>
<p>Layer可看作渲染地图的层容器，具体的数据需要通过Source设置。</p>
<p>地图数据根据数据源（Source）可分为Image、Tile、Vector三大类型的数据源类，对应设置到地图图层（Layer）的Image、Tile、Vector三大类的图层中。其中，矢量图层Vector通过样式（Style）来设置矢量要素渲染的方式和外观。</p>
<p>Source和Layer是一对一的关系，有一个Source，必然需要一个Layer，然后把Layer添加到Map上，就可以显示出来了。</p>
<p><img src="../../../../typora/images/20180727115727932" alt="img"></p>
<p>在数据源中：</p>
<ul>
<li>Tile类为<strong>瓦片抽象基类</strong>，其子类作为各类瓦片数据的数据源。、</li>
<li>Vector类为<strong>矢量数据源基类</strong>，为矢量图层提供具体的数据来源，包括直接组织或读取的矢量数据（<strong>Features</strong>）、远程数据源的矢量数据（即通过url设置数据源路径）等。若是url设置的矢量数据源，则通过解析器Format（即ol.format.Feature的子类）来解析各类矢量数据，如XML、Text、JSON、GML、KML、GPS、WFS、WKT、GeoJSON等地图数据。</li>
<li>Image类为<strong>单一图像基类</strong>，其子类为画布（canvas）元素、服务器图片、单个静态图片、WMS单一图像等的数据源。它与Tile类的区别在于，Image类对应的是一整张大图片，而不像瓦片那样很多张小图片，从而无需切片，也可以加载一些地图，适用于一些小场景地图。</li>
</ul>
<p>从复杂度来分析，Image类和Vector类都不复杂，其数据格式和来源方式都简单。而Tile类则不一样，由于一些历史问题，多个服务提供商，多种标准等诸多原因，导致要支持世界上大多数的瓦片数据源，就需要针对这些差异（这些差异主要是瓦片坐标系不同、分辨率不同等，后面会详细介绍）提供不同的Tile数据源支持。我们先来看一下OpenLayers现在支持的Source具体有哪些：<br><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152916.png" alt="img"></p>
<p>   上图中的类是按照继承关系，从左向右展开的，左边的为父类，右边的为子类。在使用时，一般来说，都是直接使用叶子节点上的类，基本就可以完成需求。父类需要自己进一步扩展或者处理才能有效使用。</p>
<p>我们先了解最为复杂的ol.source.Tile，其叶子节点类有很多，大致可以分为几类：</p>
<ul>
<li><strong>在线服务的Source</strong>，包括ol.source.BingMaps（使用的是微软提供的Bing在线地图数据）、ol.source.Stamen（使用的是Stamen提供的在线地图数据）。没有自己的地图服务器的情况下，可直接使用它们，加载地图底图。</li>
<li><strong>支持协议标准的Source</strong>，包括ol.source.TileArcGISRest、ol.source.TileWMS、ol.source.WMTS、ol.source.UTFGrid、ol.source.TileJSON。如果要使用它们，首先你得先学习对应的协议，之后必须找到支持这些协议的服务器来提供数据源，这些服务器可以是底图服务提供商提供的，也可以是自己搭建的服务器，关键是得支持这些协议。</li>
<li> <strong>ol.source.XYZ</strong>，这个需要单独提一下，因为是可以直接使用的，而且现在很多地图服务（在线的，或者自己搭建的服务器）都支持xyz方式的请求。国内在线的地图服务，高德、天地图等，都可以通过这种方式加载，本地离线瓦片地图也可以，用途广泛，且简单易学。</li>
</ul>
<p>ol.source.Image虽然有几种不同的子类，但大多比较简单，因为不牵涉到过多的协议和服务提供商。而ol.source.Vector就更加简单了，但有时候其唯一的子类ol.source.Cluster在处理大量的要素时，我们可能需要使用。</p>
<p>在大概了解了整个Source之后，紧接着该介绍它的搭档Layer了，同样的，我们还是先从OpenLayers现有的Layer类图大致了解一下：</p>
<p><img src="../../../../typora/images/20180731110040946" alt="img"></p>
<p>为了便于了解和使用，图中标注了每一个Layer对应的Source。通过上图可以看到Layer相对于Source而言，真是太简单了。</p>
<p>其中ol.layer.Group是一个用于将多个图层存储在一起的集合类，以后接触到相关内容再介绍。</p>
<h3 id="瓦片地图"><a href="#瓦片地图" class="headerlink" title="瓦片地图"></a>瓦片地图</h3><h4 id="瓦片地图-1"><a href="#瓦片地图-1" class="headerlink" title="瓦片地图"></a>瓦片地图</h4><p>瓦片地图（也叫切片地图）源于一种大地图解决方案，就是在多个比例尺下配置地图，然后提前把每个比例尺下的地图绘制为小块图片（瓦片），保存在服务器上用于缓存的目录中。这样客户端在访问地图时，可以直接获取需要的小块图片拼接成整幅地图，而不是由服务器动态创建（实时创建）出一幅图片再发送到客户端，从而极大提高了访问速度。</p>
<p>瓦片地图起始于谷歌地图。在2005年前后谷歌地图已经开始将矢量图层融合为一张栅格化的大图像，大图像被切分为256像素 x 256像素的图片（瓦片）。这些图片预先生成并存储在磁盘上，以便快速分发（通过AJAX）到客户端。这样做可以同时支持成千上万个并发请求（异步-因为瓦片地图根据请求范围加载），而这对于动态地图绘制而言基本是不可能的。</p>
<p>瓦片地图的缺点是不能改变图层的符号，可以认为它们是一些”死图片”，不能进行更新。因此，WebGIS中通常的做法是将通用的基础底图图层发布为瓦片，在其上叠加另外的包含专题信息的图层，这种图层结构可以被比喻为”图层三明治”。</p>
<p>如今有许多软件提供创建地图瓦片的功能，商业软件中，功能强大的ArcGIS软件系列的ArcGIS Server（价格较贵）能够进行创建瓦片地图操作，国内的超图SuperMap iServer同样也能创建瓦片地图。另外，开源的Mapnik库也可以创建地图瓦片，Mapnik库被封装在用户友好的应用程序TileMill中。</p>
<h4 id="LOD"><a href="#LOD" class="headerlink" title="LOD"></a>LOD</h4><p>LOD是<strong>Levels of Detail（细节层级）</strong>的简写，用于根据当前的环境，渲染不同的图像，用于降低非重要内容的细节度，从而提高渲染效率，在电子游戏中经常运用，对于需要显示全球地图的GIS系统而言，更需要应用这项技术。</p>
<p>在不同的LOD下，自然分辨率就可能不一样，这两者是紧密结合在一起的。对于图形显示系统而言，分辨率作为屏幕坐标和世界坐标之间计算的纽带，其作用是非常重要的（例如，屏幕上两个像素点间的距离对应的现实世界的距离是多少，这就需要通过分辨率来衡量与计算——分辨率将在后面进行介绍）。</p>
<p>在详细讲解之前，假设给你两张A4纸，在其中一张纸上把你家整个绘制上去，在另一张纸上只把你睡的房间绘制上去。如果别人想看你家，你会给哪一张纸？如果想看你睡的房间，你会给哪一张纸？相信你不会给错，LOD就是这种根据不同需要，采用不同图的技术方案。在地图应用中，最直观的体验，就是地图放大缩小。当地图放大后，能看到更详细的地理信息，比如街道、商店等等。当地图缩小再缩小，原来能看到的街道、商店就看不见了，但是能看到更大的区域。我们的屏幕就相当于是A4纸，大小不变。</p>
<p>LOD这个技术方案非常棒！非常符合我们的自然习惯，所以在很多图形系统中都使用了这项技术。在GIS系统中，不断放大，就能看到更多地图细节，了解更加详细的信息。对于GIS引擎的开发者而言，需要实现这项技术，当发现用户放大地图时，就立马使用更有细节的地图图片，替换现在显示的地图图片。现在问题来了：意思是说对于同一个地点而言，需要有更多张呈现不同细节程度的图片？是的，你没有猜错。虽然在使用瓦片地图的过程中，感觉放大、缩小地图是浑然一体的，但其实就在你眼皮下发生了图片替换。不同层级使用具有不同细节的地图瓦片，这就需要为每一个层级准备图片，如果使用离线工具下载瓦片地图，会看到下载的图片是按照层级Z进行存储的。开发者不用担心数据源的处理，只需要知道这个原理就可以了。</p>
<p>为了便于理解GIS系统中不同层级，使用不同的图片，下面使用google在线瓦片地图进行说明。最小层级0情况下，只用了一张256*256像素的图片表示整个地球平面：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152924.png" alt="img"></p>
<p>稍大一个层级1情况下，用了四张256*256像素的图片（各张图片中表示的信息更丰富了）来表示整个地球：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152929.png" alt="image-20210922092323241"></p>
<h4 id="瓦片计算"><a href="#瓦片计算" class="headerlink" title="瓦片计算"></a>瓦片计算</h4><blockquote>
<p>切片方式</p>
</blockquote>
<p>   如果对整个地球图片进行切片，需要考虑的是整个地球图片大小，以及切片规则，切片（瓦片）大小。</p>
<p>对于WebGIS而言，在线地图几乎都采用Web墨卡托投影坐标系（EPSG:3857，后面会详解介绍)，地球投影到平面上就是一个正方形。为了方便使用，切片时大多按照正方形的方式来进行切片，比如大小为256<em>256的瓦片（单位像素），一个1024</em>1024的地图，就可以切片4张小的256*256的瓦片。</p>
<p>瓦片大小几乎都是256<em>256，有一些则会增加到512</em>512（由于以前的屏幕分辨率通常比较低，所以256<em>256的瓦片在低分辨率的屏幕上显示效果比较好，随着屏幕分辨率的提高，瓦片大小自然就会增加到512</em>512。但目前主流仍是256*256大小的瓦片）。</p>
<p>LOD会使得不同层级下的全球地图大小不一致，结合瓦片地图技术一起，就出现了金字塔瓦片结构：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152933.png" alt="img"></p>
<p>在金字塔瓦片结构中，上一层级的一张瓦片，在更大一层级中，会用4张瓦片来表示，依次类推，比如上一篇文章中看到的<strong>Google在线瓦片地图</strong>的第0级和第1级的瓦片地图就呈现这样的规律。这样做可以维持正方形的投影方式不变，同时按照2的幂次方放大（<strong>瓦片</strong>的边长），计算效率非常高。</p>
<blockquote>
<p>瓦片数量计算</p>
</blockquote>
<p>通过上面切片的介绍，我们可以对每一层级拥有的瓦片的数量进行简单的计算：</p>
<ul>
<li>层级0的瓦片数是 1 = 2^0 ∗ 2^0</li>
<li>层级1的瓦片数是 4 = 2^1 * 2^1</li>
<li>层级2的瓦片数是 16 = 2^2 * 2^2</li>
<li>层级3的瓦片数是 64 = 2^3 * 2^3</li>
<li>层级z的瓦片数是 2^z * 2^z</li>
</ul>
<blockquote>
<p>瓦片坐标系</p>
</blockquote>
<p>从以上的金字塔瓦片结构可以看出来，瓦片的组织方式是三维的，因此对一幅地图进行切片时，需要给每一块瓦片进行详细的编号，即需要指定每一块瓦片的行号、列号以及层级数。</p>
<p>这个问题就涉及到了瓦片坐标系，瓦片坐标系是瓦片地图的组织参考框架。它规定每一块瓦片的行号、列号以及层级数，另外，在瓦片坐标系中列号一般从左到右方向递增，而在瓦片坐标系中行号有可能沿着从上到下的方向递增，或者从下到上递增，所以不同的瓦片坐标系的起始点（原点）不同。</p>
<p>不同的在线地图服务商，可能定义不一样的瓦片坐标系，瓦片坐标系不一样，那么对应的同一个位置的瓦片的坐标也会不一样。需要引起重视。</p>
<p>OpenLayers提供了一个用于调试瓦片坐标系的ol.source.TileDebug类。借助这个类，我们可以清晰的看到每一个瓦片的坐标：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152938.png" alt="image-20210922094122522"></p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>瓦片坐标<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"> <span class="selector-tag">html</span>, <span class="selector-tag">body</span>, <span class="selector-id">#map</span> &#123; <span class="attribute">width</span>: <span class="number">100%</span>; <span class="attribute">height</span>: <span class="number">100%</span>; &#125; </span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> osmSource = <span class="keyword">new</span> ol.source.OSM();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;),</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;</span></span><br><span class="line"><span class="javascript">            source: <span class="keyword">new</span> ol.source.TileDebug(&#123;</span></span><br><span class="line"><span class="javascript">                projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,            <span class="comment">// Web墨卡托投影坐标系</span></span></span><br><span class="line"><span class="javascript">                tileGrid: osmSource.getTileGrid()   <span class="comment">// 获取OSM地图的瓦片坐标系</span></span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">          </span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">//滑块缩放控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomSlider(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//缩放至特定地点控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ZoomToExtent(&#123;           <span class="comment">// 缩放至特定位置控件      </span></span></span><br><span class="line">          extent: [</span><br><span class="line"><span class="javascript">            <span class="comment">//前两个元素表示位置矩形的左下角坐标，后两个元素表示位置矩形的右上角坐标,该点坐标是深圳市</span></span></span><br><span class="line">            12667718, 2562800,</span><br><span class="line">            12718359, 2597725</span><br><span class="line">          ]</span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="comment">//全屏控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.FullScreen(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//坐标拾取控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.MousePosition(),</span></span><br><span class="line"><span class="javascript">        <span class="comment">//鹰眼控件</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.OverviewMap(&#123;        <span class="comment">// 实例化一个OverviewMap类的对象，并加入到地图中</span></span></span><br><span class="line"><span class="javascript">          collapsed: <span class="literal">false</span></span></span><br><span class="line">        &#125;),</span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.control.ScaleLine(&#123;</span></span><br><span class="line"><span class="javascript">          units:<span class="string">&#x27;degrees&#x27;</span></span></span><br><span class="line">        &#125;)      </span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p> 首先从上图可以看到地图上多了网格，每一个网格对应的就是一个<strong>瓦片</strong>。</p>
<p>  其次网格中有三个数字，这些数字就表示当前<strong>瓦片</strong>的坐标：</p>
<ul>
<li>第一个数字是层级z</li>
<li>第二个数字是表示经度方向上的x（列号）</li>
<li>第三个数字是表示纬度方向上的y（行号）</li>
</ul>
<h3 id="分辨率"><a href="#分辨率" class="headerlink" title="分辨率"></a>分辨率</h3><h4 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h4><p>分辨率的简单定义是屏幕上的1像素表示的现实世界的地面实际距离。</p>
<p>上一节说到了金字塔瓦片结构中每一个层级，会使用不同数量的瓦片来表示整个地球，那么无论是哪一个层级，所表示的实际地理空间范围都是一致的，但使用的瓦片个数却是不一样的。</p>
<p>以Google在线地图为例，层级0使用了一个瓦片，层级1使用了4个瓦片。通过计算可以知道层级0的整个地球图像（瓦片）为256<em>256像素大小，层级1整个地球图像为512</em>512像素大小。而层级0和层级1表示的地球范围都是一样的（经度[-180°, 180°]，纬度[-90°, 90°]）。在层级0的时候，一个像素在水平方向就表示360°/256 = 1.40625°这么长的经度范围（以度为单位），在竖直方向就表示180°/256 = 0.703125°这么长的纬度范围（以度为单位）。而这两个数字就是分辨率了，即一个像素所表示的现实世界的范围是多少，这个范围可能是度（在地理坐标系统中），可能是米（在投影坐标系统中），或者其他单位，根据具体的情况而定。</p>
<h4 id="Web墨卡托投影坐标系中的分辨率"><a href="#Web墨卡托投影坐标系中的分辨率" class="headerlink" title="Web墨卡托投影坐标系中的分辨率"></a>Web墨卡托投影坐标系中的分辨率</h4><p>我们知道，在WebGIS中使用的在线瓦片地图是采用的Web墨卡托（Mercator）投影坐标系（可以查看这篇文章-墨卡托投影-来了解详细内容），经过投影后，整个地球是一个正方形，所能表示的地球范围为：</p>
<p><strong>经度[-180°, 180°]，纬度[-85°, 85°]，单位为度。</strong></p>
<p>对应的Web墨卡托坐标系的范围为：</p>
<p><strong>x[-20037508.3427892, 20037508.3427892]，范围y同样是[-20037508.3427892, 20037508.3427892]，单位为米。</strong></p>
<p>或许，你会好奇这个范围是怎么计算而来的，如果详细了解过它的定义，应该知道<strong>Web墨卡托投影只是简单的把地球球面剖开拉伸为一个正方形，由于南北极两端采用这种拉伸会严重变形，并且南北极在使用过程中很少用到，所以干脆就只投影了地球的[-85, 85]纬度范围。然后在经度-180度（或+180）的地方从上到下剖开地球，然后按照赤道方向来展开成一张平面，那么这个平面的边长，就等于以地球赤道半径按照圆来计算的周长</strong>。近似的按照6378137米为地球半径来计算，那么整个赤道周长的一半，即为：</p>
<p>π∗r=3.1415926∗6378137=20037508.0009862</p>
<p>以上就是Web墨卡托投影坐标系范围的完整的计算过程，墨卡托投影也有很多变形，会有细微的不同，OpenLayers默认使用的就是EPSG:3857（Web墨卡托投影坐标系），对于该坐标系的详细定义，可以参见epsg.io.3867。</p>
<p>有了范围之后，要想计算Web墨卡托投影坐标系中的分辨率，按照上面的计算过程就非常简单了，还是以Google在线瓦片地图为例，x、y方向上的各层级瓦片地图分辨率计算公式可以归纳为：</p>
<p>*<em>resolution = rang / (256 * 2^z)*</em></p>
<p>rang    ——    表示x方向或y方向上的整个范围，比如20037508.3427892 * 2。<br>256    ——    表示一个瓦片的边长，单位为像素。<br>2^z    ——    表示在层级z下，x或y方向上的瓦片个数。<br>那么整个公式计算出来就是在x或y方向，屏幕上一个像素所能代表的实际地理范围，即分辨率。</p>
<h4 id="OpenLayers默认使用的分辨率"><a href="#OpenLayers默认使用的分辨率" class="headerlink" title="OpenLayers默认使用的分辨率"></a>OpenLayers默认使用的分辨率</h4><p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152944.png" alt="image-20210922100134999"></p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>OpenLayers中默认的分辨率<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">span</span>&gt;</span>当前地图等级:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span> = <span class="string">&#x27;zoom&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span> <span class="tag">&lt;<span class="name">span</span>&gt;</span>当前分辨率:<span class="tag">&lt;/<span class="name">span</span>&gt;</span><span class="tag">&lt;<span class="name">span</span> <span class="attr">id</span> = <span class="string">&#x27;resolution&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> osmSource = <span class="keyword">new</span> ol.source.OSM();</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">              source: <span class="keyword">new</span> ol.source.OSM()     <span class="comment">// OpenStreetMap数据源</span></span></span><br><span class="line">          &#125;)</span><br><span class="line">          </span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line">       </span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="javascript">    map.getView().on(<span class="string">&#x27;change:resolution&#x27;</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">&#x27;zoom&#x27;</span>).innerHTML =  <span class="built_in">this</span>.getZoom() + <span class="string">&#x27;，&#x27;</span>;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">&#x27;resolution&#x27;</span>).innerHTML = <span class="built_in">this</span>.getResolution();</span></span><br><span class="line">    &#125;)</span><br><span class="line">  </span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;zoom&#x27;</span>).innerHTML = map.getView().getZoom() + <span class="string">&#x27;，&#x27;</span>;</span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.getElementById(<span class="string">&#x27;resolution&#x27;</span>).innerHTML = + map.getView().getResolution();</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>缩放上面的地图，从层级0开始，用前面介绍的公式和当前地图显示的<strong>分辨率</strong>进行比较，你会发现OpenLayers默认采用的<strong>分辨率</strong>和<strong>Google在线瓦片地图</strong>一样。  </p>
<p>OpenLayers<strong>瓦片地图</strong>默认分辨率表（地面比例尺）：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152949.png" alt="img"></p>
<blockquote>
<p>注意事项</p>
</blockquote>
<p>为什么我们上面一直以<strong>Google在线瓦片地图</strong>举例说明？</p>
<p>因为不同的<strong>在线瓦片地图</strong>可能采用不一样的<strong>分辨率</strong>，比如<strong>百度在线瓦片地图</strong>。所以在使用<strong>在线瓦片地图</strong>或者自己制作的<strong>瓦片地图</strong>时，都需要知道使用的<strong>分辨率</strong>是多少。如若不然，可能也会出现位置偏移。</p>
<h3 id="使用XYZ方式加载瓦片数据"><a href="#使用XYZ方式加载瓦片数据" class="headerlink" title="使用XYZ方式加载瓦片数据"></a>使用XYZ方式加载瓦片数据</h3><h4 id="使用XYZ方式加载高德瓦片数据"><a href="#使用XYZ方式加载高德瓦片数据" class="headerlink" title="使用XYZ方式加载高德瓦片数据"></a>使用XYZ方式加载高德瓦片数据</h4><p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152954.png" alt="image-20210922103307387"></p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>使用XYZ方式加载搞得瓦片数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">            source: <span class="keyword">new</span> ol.source.XYZ(&#123;</span></span><br><span class="line"><span class="javascript">                    url:<span class="string">&#x27;http://webst0&#123;1-4&#125;.is.autonavi.com/appmaptile?lang=zh_cn&amp;size=1&amp;scale=1&amp;style=7&amp;x=&#123;x&#125;&amp;y=&#123;y&#125;&amp;z=&#123;z&#125;&#x27;</span></span></span><br><span class="line">                &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line">       </span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>目前高德的瓦片地址有如下两种：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://wprd0{1-4}.is.autonavi.com/appmaptile?x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=7%E5%92%8C">http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=7和</a></li>
<li><a target="_blank" rel="noopener" href="http://webst0{1-4}.is.autonavi.com/appmaptile?style=7&amp;x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D">http://webst0{1-4}.is.autonavi.com/appmaptile?style=7&amp;x={x}&amp;y={y}&amp;z={z}</a></li>
</ul>
<p>前者是高德的新版地址，后者是老版地址。</p>
<p>高德新版的参数：</p>
<ul>
<li>lang可以通过zh_cn设置中文，en设置英文；</li>
<li>size基本无作用；</li>
<li>scl设置标注还是底图，scl=1代表注记，scl=2代表底图（矢量或者影像）；</li>
<li>style设置影像和路网，style=6为影像图，style=7为矢量路网，style=8为影像路网。</li>
</ul>
<p>总结之：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://wprd0{1-4}.is.autonavi.com/appmaptile?x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=7">http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=7</a> 为矢量图（含路网、含注记）</li>
<li><a target="_blank" rel="noopener" href="http://wprd0{1-4}.is.autonavi.com/appmaptile?x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=7">http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=7</a> 为矢量图（含路网，不含注记）</li>
<li><a target="_blank" rel="noopener" href="http://wprd0{1-4}.is.autonavi.com/appmaptile?x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=6">http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=6</a> 为影像底图（不含路网，不含注记）</li>
<li><a target="_blank" rel="noopener" href="http://wprd0{1-4}.is.autonavi.com/appmaptile?x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=6">http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=6</a> 为影像底图（不含路网、不含注记）</li>
<li><a target="_blank" rel="noopener" href="http://wprd0{1-4}.is.autonavi.com/appmaptile?x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=8">http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=1&amp;style=8</a> 为影像路图（含路网，含注记）</li>
<li><a target="_blank" rel="noopener" href="http://wprd0{1-4}.is.autonavi.com/appmaptile?x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=8">http://wprd0{1-4}.is.autonavi.com/appmaptile?x={x}&amp;y={y}&amp;z={z}&amp;lang=zh_cn&amp;size=1&amp;scl=2&amp;style=8</a> 为影像路网（含路网，不含注记）</li>
</ul>
<p>高德旧版可以通过style参数设置影像、矢量、路网。</p>
<p>总结之：</p>
<ul>
<li><a target="_blank" rel="noopener" href="http://webst0{1-4}.is.autonavi.com/appmaptile?style=6&amp;x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D">http://webst0{1-4}.is.autonavi.com/appmaptile?style=6&amp;x={x}&amp;y={y}&amp;z={z}</a> 为影像底图（不含路网，不含注记）</li>
<li><a target="_blank" rel="noopener" href="http://webst0{1-4}.is.autonavi.com/appmaptile?style=7&amp;x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D">http://webst0{1-4}.is.autonavi.com/appmaptile?style=7&amp;x={x}&amp;y={y}&amp;z={z}</a> 为矢量地图（含路网，含注记）</li>
<li><a target="_blank" rel="noopener" href="http://webst0{1-4}.is.autonavi.com/appmaptile?style=8&amp;x=%7Bx%7D&amp;y=%7By%7D&amp;z=%7Bz%7D">http://webst0{1-4}.is.autonavi.com/appmaptile?style=8&amp;x={x}&amp;y={y}&amp;z={z}</a> 为影像路网（含路网，含注记）</li>
</ul>
<h4 id="使用XYZ方式加载雅虎地图"><a href="#使用XYZ方式加载雅虎地图" class="headerlink" title="使用XYZ方式加载雅虎地图"></a>使用XYZ方式加载雅虎地图</h4><p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922153000.png" alt="image-20210922104017162"></p>
<p>代码如下;</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>使用XYZ方式加载雅虎瓦片数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">//创建地图容器</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      <span class="comment">//指定关联的div容器</span></span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line"><span class="javascript">      <span class="comment">//瓦片图层                          </span></span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">          <span class="keyword">new</span> ol.layer.Tile(&#123;                 </span></span><br><span class="line"><span class="javascript">            source: <span class="keyword">new</span> ol.source.XYZ(&#123;</span></span><br><span class="line"><span class="javascript">              url:<span class="string">&#x27;https://&#123;0-3&#125;.base.maps.api.here.com/maptile/2.1/maptile/newest/normal.day/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;/512/png8?lg=ENG&amp;ppi=250&amp;token=TrLJuXVK62IQk0vuXFzaig%3D%3D&amp;requestid=yahoo.prod&amp;app_id=eAdkWGYRoc4RfxVo0Z4B&#x27;</span>,</span></span><br><span class="line"><span class="javascript">              tileSize: <span class="number">512</span>               <span class="comment">// 设置对应的瓦片大小</span></span></span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      <span class="comment">//地图视图</span></span></span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">//空间参考系统 openLayers 自带两个空间参考系统 EPSG:3857 和 EPSG:4326  </span></span></span><br><span class="line"><span class="javascript">          <span class="comment">//我们一般使用的经纬度 是 WGS84 需要拓展</span></span></span><br><span class="line"><span class="javascript">          projection: <span class="string">&#x27;EPSG:3857&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="comment">//地图中心点</span></span></span><br><span class="line">          center: [0, 0],</span><br><span class="line"><span class="javascript">          <span class="comment">//缩放级别</span></span></span><br><span class="line">          zoom: 0</span><br><span class="line">      &#125;),</span><br><span class="line"><span class="javascript">      <span class="comment">//控件层</span></span></span><br><span class="line"><span class="javascript">      controls: ol.control.defaults().extend([    <span class="comment">// 往地图增加滑块缩放控件</span></span></span><br><span class="line">       </span><br><span class="line">      ])</span><br><span class="line"></span><br><span class="line">    &#125;);</span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>大同小异，非常简单。上面的三个例子，只有Yahoo地图的代码有点不一样：多了tileSize参数的设置。</p>
<p>默认情况下，tileSize为256，这也是现在绝大多数瓦片采用的大小。但Yahoo地图使用的是512，所以我们需要指定。</p>
<h3 id="OpenLayers修改瓦片坐标系及分辨率"><a href="#OpenLayers修改瓦片坐标系及分辨率" class="headerlink" title="OpenLayers修改瓦片坐标系及分辨率"></a>OpenLayers修改瓦片坐标系及分辨率</h3><p>前面的文章已经简单介绍了瓦片坐标系是瓦片地图的组织框架，现在我们来详细探讨OpenLayers中的瓦片坐标系，从而让我们在加载各种瓦片地图的过程中能得心应手。</p>
<h4 id="OpenLayers中定义瓦片坐标系的接口"><a href="#OpenLayers中定义瓦片坐标系的接口" class="headerlink" title="OpenLayers中定义瓦片坐标系的接口"></a>OpenLayers中定义瓦片坐标系的接口</h4><p>前面的文章介绍了使用ol.source.TileDebug类可以让我们清晰的看到每一个瓦片的坐标，我们来看一下TileDebug这个类的API文档：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922153005.png" alt="img"></p>
<p>可以看到实例化类的参数中有一个tileGrid参数，这个参数就是用于指定ol.source.TileDebug的瓦片坐标系，而ol.tilegrid.TileGrid类就是瓦片坐标系的抽象表示，即在OpenLayers中就是用这个类来定义瓦片坐标系。</p>
<p>那我们就来看看ol.tilegrid.TileGrid类的API：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922153009.png" alt="image-20210922105528937"></p>
<p>上面各个初始化类的参数分别表示：</p>
<ul>
<li>extent    ——    请求加载的瓦片的范围，不在这个范围内的瓦片不会被请求并加载。默认是全球范围</li>
<li>minZoom    ——    瓦片坐标系的最小层级，比minZoom更小层级的瓦片不会被请求并加载。</li>
<li>origin    ——    瓦片坐标系水平方向上的起始点（原点）。默认的原点为extent的左上角（top-left）。其中，瓦片坐标在x方向从左到右递增，在y方向从下到上递增。</li>
<li>origins    ——    瓦片坐标系各个层级的水平方向上的起始点（原点），即每个层级可以指定不同的水平方向上的原点。</li>
<li>resolutions    ——    瓦片坐标系各个层级的瓦片分辨率，即不同层级的瓦片的分辨率可以不同。</li>
<li>tileSize    ——    瓦片的大小。</li>
<li>tileSizes    ——    瓦片坐标系各个层级的瓦片大小，即不同层级的瓦片的大小可以不同。</li>
</ul>
<h4 id="自定义OpenLayers瓦片坐标系来加载百度地图"><a href="#自定义OpenLayers瓦片坐标系来加载百度地图" class="headerlink" title="自定义OpenLayers瓦片坐标系来加载百度地图"></a>自定义OpenLayers瓦片坐标系来加载百度地图</h4><p>前面一篇文章讲到可以使用XYZ的方式非常简单的加载瓦片地图，但遗憾地是，这种简单方法并不适用于所有的在线瓦片地图，总有一些是特殊的，比如百度地图。</p>
<p>瓦片地图加载的关键在于找对瓦片，但要找对瓦片，就得知道瓦片的坐标，而瓦片坐标又需要明确的瓦片坐标系。</p>
<p>通过前面的API文档，我们可以知道OpenLayer的默认瓦片坐标系的原点在左上角，从左到右为x轴正方向，从下到上为y轴正方向。</p>
<p>具体到地图上来讲，地球经过投影，投影到一个平面上，平面最左边对应地球最西边，平面最上边对应地球最北边。原点就处于整个平面的左上角，即地球的西北角，从北向南为y轴负方向，从西向东为x轴正方向。理解这一点非常重要，因为并不是所有在线的瓦片地图都是采用这样的瓦片坐标系。用OpenLayers加载它们的时候，如果瓦片坐标系不同，计算出来的瓦片地址就获取不到对应的瓦片，为解决这个问题，我们必须要先对瓦片坐标进行转换。</p>
<p>那么，具体该怎么实现转换？最详细明了的方式还是看实例，下面我们看一下加载百度地图的一种实现方式：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922153014.png" alt="image-20210922110819191"></p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>自定义瓦片坐标系加载百度地图<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">     <span class="comment">// 百度地图图层</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> baiduMapLayer = <span class="keyword">new</span> ol.layer.Tile(&#123;</span></span><br><span class="line"><span class="javascript">      source: <span class="keyword">new</span> ol.source.XYZ(&#123;</span></span><br><span class="line">          tilePixelRatio: 2,</span><br><span class="line"><span class="javascript">          tileUrlFunction: <span class="function"><span class="keyword">function</span>(<span class="params">tileCoord</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">let</span> z = tileCoord[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">              <span class="keyword">let</span> x = tileCoord[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">              <span class="keyword">let</span> y = tileCoord[<span class="number">2</span>];</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 计算当前层级下X或Y方向上瓦片总数的一半，用于定位整个地图的中心点</span></span></span><br><span class="line"><span class="javascript">              <span class="keyword">let</span> halfTileNum = <span class="built_in">Math</span>.pow(<span class="number">2</span>, z - <span class="number">1</span>);</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 原点从左上角移到中心点后，计算xy方向上新的坐标位置</span></span></span><br><span class="line"><span class="javascript">              <span class="keyword">let</span> baiduX = x - halfTileNum;</span></span><br><span class="line"><span class="javascript">              <span class="keyword">let</span> baiduY = y + halfTileNum;</span></span><br><span class="line"><span class="javascript">              <span class="comment">// 百度瓦片服务url将负数使用M前缀来标识</span></span></span><br><span class="line"><span class="javascript">              <span class="keyword">if</span>(baiduX &lt; <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                  baiduX = <span class="string">&#x27;M&#x27;</span> + (-baiduX);</span></span><br><span class="line">              &#125;</span><br><span class="line"><span class="javascript">              <span class="keyword">if</span>(baiduY &lt; <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                  baiduY = <span class="string">&#x27;M&#x27;</span> + (-baiduY);</span></span><br><span class="line">              &#125;</span><br><span class="line"><span class="javascript">              <span class="comment">// 返回经过转换后，对应于百度在线瓦片的url</span></span></span><br><span class="line"><span class="javascript">              <span class="keyword">return</span> <span class="string">&#x27;http://online2.map.bdimg.com/onlinelabel/?qt=tile&amp;x=&#x27;</span> + baiduX + <span class="string">&#x27;&amp;y=&#x27;</span> + baiduY + <span class="string">&#x27;&amp;z=&#x27;</span> + z + <span class="string">&#x27;&amp;styles=pl&amp;udt=20160321&amp;scaler=2&amp;p=0&#x27;</span>;</span></span><br><span class="line">          &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line">      layers: [</span><br><span class="line">        baiduMapLayer</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">        center: ol.proj.fromLonLat([<span class="number">104.06</span>, <span class="number">30.67</span>]),  <span class="comment">// 设置成都为中心点</span></span></span><br><span class="line">        zoom: 4</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>首先我们需要理解一下<strong>tilePixelRatio</strong>参数，它表示瓦片服务使用的像素比，例如，<strong>如果瓦片服务发布256px * 256px的瓦片，但是实际发送的却是512px * 512px的图像，则tilePixelRatio需要设置为2</strong>。百度地图这个例子就是这个情况。</p>
<p>和前面几个加载在线瓦片地图的例子不一样的地方在于，我们没有设置url，而是设置了<strong>tileUrlFunction</strong>，这是一个<strong>获取瓦片url的函数</strong>。如果自定义这个函数，就可以实现不同瓦片坐标系之间的转换，从而返回在线地图服务对应的url。通过代码可以看到，函数参数是一个瓦片坐标，然后进行一系列的转换，得到百度在线地图的瓦片地址。</p>
<p>tileUrlFunction这个自定义函数的代码实现有可能看不懂，虽然知道在进行坐标转换，但并不知道为什么要这样实现。为了彻底弄明白代码，我们必须得把之前遗漏的一个重要环节补上：弄明白待加载的在线瓦片地图的坐标系。</p>
<p>对百度在线瓦片坐标系进行简单分析发现，<strong>它是以某一个位置为原点，向右为x正方向，向上为y正方向的瓦片坐标系。进一步分析发现，原点应该在中心位置</strong>，在此基础上编写函数tileUrlFunction的实现。halfTileNum表示的是在当前缩放层级之下，x方向或y方向的瓦片个数的一半，意味着它就是中心位置。对于baiduX小于0的情况，百度使用了M来表示负号，所以要特殊处理一下。想必这下应该更加理解代码实现了。不同的在线瓦片地图的转换代码可能不同，需要根据对应的瓦片坐标系来确定。</p>
<p>但上面这个地图并不完美，因为我们设定的地图中心为成都，然而实际上显示的地图中心并不在成都。虽然无缝拼接，但位置偏差有点远。由此基本可以排除坐标转换的问题，看起来应该是<strong>OpenLayers的分辨率和百度在线瓦片地图使用的分辨率对不上</strong>。经过分析发现，确实如此，在网上也有很多分析文章可以查询。那么我们是否可以重新定义分辨率呢？答案是肯定的。</p>
<p>我们可以通过自定义瓦片坐标系来修改分辨率：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922153031.png" alt="image-20210922112704703"></p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>自定义瓦片坐标系加载百度地图<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> resolutions = [];</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> maxZoom = <span class="number">18</span>;</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript">    <span class="comment">// 计算百度使用的分辨率</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">for</span>(<span class="keyword">var</span> i=<span class="number">0</span>; i&lt;=maxZoom; i++)&#123;</span></span><br><span class="line"><span class="javascript">            resolutions[i] = <span class="built_in">Math</span>.pow(<span class="number">2</span>, maxZoom-i);</span></span><br><span class="line">    &#125;</span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> tilegrid  = <span class="keyword">new</span> ol.tilegrid.TileGrid(&#123;</span></span><br><span class="line"><span class="javascript">      origin: [<span class="number">0</span>, <span class="number">0</span>],                     <span class="comment">// 将原点设置成和百度瓦片坐标系一致</span></span></span><br><span class="line"><span class="javascript">      resolutions: resolutions            <span class="comment">// 设置分辨率</span></span></span><br><span class="line">    &#125;);</span><br><span class="line"><span class="javascript">     <span class="comment">// 百度地图图层</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> baiduMapLayer = <span class="keyword">new</span> ol.layer.Tile(&#123;</span></span><br><span class="line"><span class="javascript">      source: <span class="keyword">new</span> ol.source.XYZ(&#123;</span></span><br><span class="line">          tilePixelRatio: 2,</span><br><span class="line">          tileGrid: tilegrid,</span><br><span class="line"><span class="javascript">          tileUrlFunction: <span class="function"><span class="keyword">function</span>(<span class="params">tileCoord</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> z = tileCoord[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> x = tileCoord[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">            <span class="keyword">let</span> y = tileCoord[<span class="number">2</span>];</span></span><br><span class="line"> </span><br><span class="line"><span class="javascript">            <span class="comment">// 百度瓦片服务url将负数使用M前缀来标识</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(x &lt; <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                x = <span class="string">&#x27;M&#x27;</span> + (-x);</span></span><br><span class="line">            &#125;</span><br><span class="line"><span class="javascript">            <span class="keyword">if</span>(y &lt; <span class="number">0</span>)&#123;</span></span><br><span class="line"><span class="javascript">                y = <span class="string">&#x27;M&#x27;</span> + (-y);</span></span><br><span class="line">            &#125;</span><br><span class="line"> </span><br><span class="line"><span class="javascript">            <span class="comment">// 返回经过转换后，对应于百度在线瓦片的url</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">return</span> <span class="string">&#x27;http://online2.map.bdimg.com/onlinelabel/?qt=tile&amp;x=&#x27;</span> + x + <span class="string">&#x27;&amp;y=&#x27;</span> + y + <span class="string">&#x27;&amp;z=&#x27;</span> + z + <span class="string">&#x27;&amp;styles=pl&amp;udt=20160321&amp;scaler=2&amp;p=0&#x27;</span>;</span></span><br><span class="line">                </span><br><span class="line">          &#125;</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line">      layers: [</span><br><span class="line">        baiduMapLayer</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line"><span class="javascript">        center: ol.proj.fromLonLat([<span class="number">104.06</span>, <span class="number">30.67</span>]),  <span class="comment">// 设置成都为中心点</span></span></span><br><span class="line">        zoom: 10</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>由于将瓦片坐标系的原点设置成百度瓦片坐标系一致，所以tileUrlFunction里就不需要对针对原点进行瓦片坐标的转换操作了。</p>
<h4 id="分析瓦片地图的瓦片坐标系"><a href="#分析瓦片地图的瓦片坐标系" class="headerlink" title="分析瓦片地图的瓦片坐标系"></a>分析瓦片地图的瓦片坐标系</h4><p>如何分析不同在线瓦片地图的瓦片坐标系呢？非常重要的一点是，先从特例触发，找简单的情况分析，比如选择z为2或者3进行分析，这种情况下，瓦片的数量比较少，可以查看整个地球范围内的地图的瓦片请求，注意分析其请求的url参数。</p>
<p>瓦片的url解析对于想直接使用在线瓦片服务的开发者而言，是一项经常要做的事。根据难度，大致可以分为三种情况：</p>
<ul>
<li>第一种情况最简单，请求瓦片的url明确有xyz参数，比如高德地图和百度地图。</li>
<li>第二种稍微难一点，xyz作为路径直接存在url里面，没有明确的参数表明哪些是xyz，比如Open Street Map和Yahoo地图，这种情况下，地图服务器收到请求后，就直接在服务器按照这个路径获取图片，按照这个逻辑，一般第一个参数表示是z，第二个参数为x，第三个参数为y。要想确认是否真是这样，可以写一个小程序来验证一下，如果还有问题，建议按照上面分析地图坐标系中的方法，从z比较小的情况入手来分析x、y、z的位置。</li>
<li>第三种则最难，地图服务提供商为了防止大家直接非法使用瓦片地图，对瓦片的url进行了加密，比如现在的微软Bing中文地图和Google地图，这种情况下只有知道如何解密才能使用。</li>
</ul>
<p>前面两种url的实例已经有了，此处分享一下第三种情况的url解密，以微软Bing中文地图为例：</p>
<h5 id="加载微软bing中文地图"><a href="#加载微软bing中文地图" class="headerlink" title="加载微软bing中文地图"></a>加载微软bing中文地图</h5><h5 id=""><a href="#" class="headerlink" title=""></a><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922153047.png" alt="image-20210922140215783"></h5><p>图中显示的瓦片地图请求的url，没有明显的xyz参数，最有可能的存放xyz参数的地方在于url前面那一串数字，真实情况确实是这样的，经过分析和解码，最终实现了加载Bing中文地图：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922153053.png" alt="image-20210922140618088"></p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>加载Bing中文地图<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">         target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line">         layers: [</span><br><span class="line"><span class="javascript">             <span class="keyword">new</span> ol.layer.Tile(&#123;</span></span><br><span class="line"><span class="javascript">                 source: <span class="keyword">new</span> ol.source.XYZ(&#123;</span></span><br><span class="line"><span class="javascript">                     tileUrlFunction: <span class="function"><span class="keyword">function</span>(<span class="params">tileCoord</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                         <span class="keyword">let</span> z = tileCoord[<span class="number">0</span>];</span></span><br><span class="line"><span class="javascript">                         <span class="keyword">let</span> x = tileCoord[<span class="number">1</span>];</span></span><br><span class="line"><span class="javascript">                         <span class="keyword">let</span> y = -tileCoord[<span class="number">2</span>] - <span class="number">1</span>;</span></span><br><span class="line"><span class="javascript">                         <span class="keyword">let</span> result=<span class="string">&#x27;&#x27;</span>, zIndex=<span class="number">0</span>;</span></span><br><span class="line">                 </span><br><span class="line"><span class="javascript">                         <span class="keyword">for</span>(zIndex = <span class="number">0</span>; zIndex &lt; z; zIndex++) &#123;</span></span><br><span class="line">                             result = ((x &amp; 1) + 2 * (y &amp; 1)).toString() + result;</span><br><span class="line">                             x &gt;&gt;= 1;</span><br><span class="line">                             y &gt;&gt;= 1;</span><br><span class="line">                         &#125;</span><br><span class="line"><span class="javascript">                         <span class="keyword">return</span> <span class="string">&#x27;http://dynamic.t0.tiles.ditu.live.com/comp/ch/&#x27;</span> + result + <span class="string">&#x27;?it=G,VE,BX,L,LA&amp;mkt=zh-cn,syr&amp;n=z&amp;og=111&amp;ur=CN&#x27;</span>;</span></span><br><span class="line">                     &#125;</span><br><span class="line">                 &#125;)</span><br><span class="line">             &#125;)</span><br><span class="line">         ],</span><br><span class="line"><span class="javascript">         view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line">             center: [0, 0],</span><br><span class="line">             zoom: 3</span><br><span class="line">         &#125;)</span><br><span class="line">     &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>需要注意的是地图数据是非常昂贵的，如果使用某一个在线地图服务，请先核实对方的版权和数据使用申明，不要侵犯对方的权益，按照要求合法使用地图。几乎所有的在线地图服务都提供了响应的服务接口，强烈建议在商用项目中使用这些接口。对于这些接口的使用，服务商都有详细的说明，在此不赘述。</p>
<h5 id="加载Google中文地图"><a href="#加载Google中文地图" class="headerlink" title="加载Google中文地图"></a>加载Google中文地图</h5><p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>加载Google中文地图<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">      target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line">      layers: [</span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> ol.layer.Tile(&#123;</span></span><br><span class="line"><span class="javascript">            source: <span class="keyword">new</span> ol.source.XYZ(&#123;</span></span><br><span class="line"><span class="javascript">                url:<span class="string">&#x27;http://www.google.cn/maps/vt/pb=!1m4!1m3!1i&#123;z&#125;!2i&#123;x&#125;!3i&#123;y&#125;!2m3!1e0!2sm!3i345013117!3m8!2szh-CN!3scn!5e1105!12m4!1e68!2m2!1sset!2sRoadmap!4e0&#x27;</span></span></span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">      ],</span><br><span class="line"><span class="javascript">      view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line">        center: [0, 0],</span><br><span class="line">        zoom: 3</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果没爬墙的话，是访问不通的。</p>
<h3 id="可重用数据源"><a href="#可重用数据源" class="headerlink" title="可重用数据源"></a>可重用数据源</h3><p>这个示例展示如何更新地图中的瓦片。</p>
<p>可以调用*<strong>*source.setUrl()**</strong>来更新瓦片地图源的URL，请注意，当更改瓦片地图源的URL时，在加载完新的瓦片之前，将不会替换现有的瓦片。</p>
<p>如果想要清除当前呈现的瓦片，则可以调用source.refresh()方法。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>可重用数据源<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;switcher&quot;</span> <span class="attr">value</span>=<span class="string">&quot;0&quot;</span>&gt;</span>January<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;switcher&quot;</span> <span class="attr">value</span>=<span class="string">&quot;1&quot;</span>&gt;</span>January (with bathymetry)<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;switcher&quot;</span> <span class="attr">value</span>=<span class="string">&quot;2&quot;</span>&gt;</span>July<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">button</span> <span class="attr">class</span>=<span class="string">&quot;switcher&quot;</span> <span class="attr">value</span>=<span class="string">&quot;3&quot;</span>&gt;</span>July (With bathymetry)<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 有mapbox瓦片地图url组成的数组</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> urls = [</span></span><br><span class="line"><span class="javascript">          <span class="string">&#x27;https://&#123;a-c&#125;.tiles.mapbox.com/v3/mapbox.blue-marble-topo-jan/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">&#x27;https://&#123;a-c&#125;.tiles.mapbox.com/v3/mapbox.blue-marble-topo-bathy-jan/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">&#x27;https://&#123;a-c&#125;.tiles.mapbox.com/v3/mapbox.blue-marble-topo-jul/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&#x27;</span>,</span></span><br><span class="line"><span class="javascript">          <span class="string">&#x27;https://&#123;a-c&#125;.tiles.mapbox.com/v3/mapbox.blue-marble-topo-bathy-jul/&#123;z&#125;/&#123;x&#125;/&#123;y&#125;.png&#x27;</span></span></span><br><span class="line">      ];</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="comment">// 瓦片地图源</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> source = <span class="keyword">new</span> ol.source.XYZ();</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">          target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line">          layers: [</span><br><span class="line"><span class="javascript">              <span class="keyword">new</span> ol.layer.Tile(&#123;</span></span><br><span class="line">                  source: source</span><br><span class="line">              &#125;)</span><br><span class="line">          ],</span><br><span class="line"><span class="javascript">          view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line">              center: [0, 0],</span><br><span class="line">              zoom: 2</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="function"><span class="keyword">function</span> <span class="title">updateUrl</span>(<span class="params">index</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">          source.setUrl(urls[index]);     <span class="comment">// 改变瓦片地图源的url</span></span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> buttons = <span class="built_in">document</span>.getElementsByClassName(<span class="string">&#x27;switcher&#x27;</span>);  </span></span><br><span class="line"><span class="javascript">      <span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>, len = buttons.length; i &lt; len; i++)&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">var</span> button = buttons[i];</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 让瓦片地图的url随用户点击按钮而变化</span></span></span><br><span class="line"><span class="javascript">          button.addEventListener(<span class="string">&#x27;click&#x27;</span>, updateUrl.bind(<span class="literal">null</span>, <span class="built_in">Number</span>(button.value)));</span></span><br><span class="line">      &#125;</span><br><span class="line"><span class="javascript">      updateUrl(<span class="number">0</span>);       <span class="comment">// 先预设置瓦片地图</span></span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="矢量地图"><a href="#矢量地图" class="headerlink" title="矢量地图"></a>矢量地图</h3><h4 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h4><p>前面介绍的瓦片地图将地理信息以一块块瓦片的形式进行组织并渲染，瓦片的本质是图片，因此不能对瓦片地图进行修改样式、空间分析等操作，而且瓦片不包含属性信息，隐含的空间信息也不能直接获取使用。</p>
<p>矢量数据使用矢量数据模型来组织地理信息，矢量数据模型采用离散对象来表示地球表面的空间要素，因此，简单来说，矢量数据包含了各个地理要素的空间坐标与属性信息，这使我们能对地理信息进行细粒度的使用与操作。</p>
<p>常用的矢量数据格式有GeoJSON、TopoJSON、KML、GML、shapfile等等。</p>
<p>在WebGIS中，使用矢量数据构成的地图被称为矢量地图，矢量地图的原理就是将包含坐标信息与属性信息的矢量数据发送到客户端，然后由客户端负责绘制矢量图层。</p>
<p>响应速度与交互性是矢量地图的优点，一旦从服务器获得了矢量数据，Web地图用户与数据的交互就会非常迅速，不会有任何延迟。另外，矢量图形无论进行放大、缩小或旋转等操作，图形都不会失真。</p>
<p>矢量地图的缺点是不能同时绘制成百上千个要素，因为矢量地图的主要操作都在客户端，所以数据量变大，客户端就会卡、慢，甚至可能崩溃。</p>
<h4 id="在OpenLaters中直接组织矢量数据"><a href="#在OpenLaters中直接组织矢量数据" class="headerlink" title="在OpenLaters中直接组织矢量数据"></a>在OpenLaters中直接组织矢量数据</h4><p>在OpenLayers中，ol.source.Vector是矢量数据源基类，为矢量图层ol.layer.Vector类提供具体的数据来源，包括直接组织或读取的矢量数据（ol.Feature）、远程数据源的矢量数据（即通过url设置数据源路径）等。</p>
<p>现在我们来尝试直接在OpenLayers中组织矢量数据然后构建矢量地图：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922153102.png" alt="image-20210922143316507"></p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>直接组织矢量数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 初始化一个点要素</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> pointFeature = <span class="keyword">new</span> ol.Feature(&#123;</span></span><br><span class="line"><span class="javascript">          geometry: <span class="keyword">new</span> ol.geom.Point([<span class="number">12958998</span>, <span class="number">4852221</span>]),       <span class="comment">// 空间信息</span></span></span><br><span class="line"><span class="javascript">          name: <span class="string">&#x27;点要素&#x27;</span>                  <span class="comment">// 属性信息</span></span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化一个线要素</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> lineFeature = <span class="keyword">new</span> ol.Feature(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 空间信息</span></span></span><br><span class="line"><span class="javascript">          geometry: <span class="keyword">new</span> ol.geom.LineString([[<span class="number">11590147</span>, <span class="number">4322577</span>], [<span class="number">13594369</span>, <span class="number">3872784</span>]]),  </span></span><br><span class="line"><span class="javascript">          name: <span class="string">&#x27;线要素&#x27;</span>                  <span class="comment">// 属性信息</span></span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化一个多边形要素</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> polygonFeature = <span class="keyword">new</span> ol.Feature(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 空间信息</span></span></span><br><span class="line"><span class="javascript">          geometry: <span class="keyword">new</span> ol.geom.Polygon([[[<span class="number">11801814</span>, <span class="number">3251012</span>], [<span class="number">14057391</span>, <span class="number">2748303</span>], [<span class="number">12714628</span>, <span class="number">1346008</span>], [<span class="number">11801814</span>, <span class="number">3251012</span>]]]),</span></span><br><span class="line"><span class="javascript">          name: <span class="string">&#x27;多边形要素&#x27;</span>              <span class="comment">// 属性信息</span></span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化一个矢量数据源, 并添加上面创建的要素</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> vectorSource = <span class="keyword">new</span> ol.source.Vector();</span></span><br><span class="line">      vectorSource.addFeature(pointFeature);</span><br><span class="line">      vectorSource.addFeature(lineFeature);</span><br><span class="line">      vectorSource.addFeature(polygonFeature);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化一个矢量图层</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> vectorLayer = <span class="keyword">new</span> ol.layer.Vector(&#123;</span></span><br><span class="line">          source: vectorSource</span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">          target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line">          layers: [</span><br><span class="line"><span class="javascript">              <span class="keyword">new</span> ol.layer.Tile(&#123;             <span class="comment">// 底图</span></span></span><br><span class="line"><span class="javascript">                  source: <span class="keyword">new</span> ol.source.OSM()</span></span><br><span class="line">              &#125;),</span><br><span class="line">              vectorLayer</span><br><span class="line">          ],</span><br><span class="line"><span class="javascript">          view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line">              center: [0, 0],</span><br><span class="line">              zoom: 0</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>在OpenLayers中，使用ol.Feature类表示地理要素，一个Feature对象就表示一个地理要素。</p>
<p>其中，Feature对象可以包含空间信息与属性信息，在上面的示例中，Feature对象的空间信息分别通过ol.geom.Point类、ol.geom.LineString类、ol.geom.Polygon类来组织，然后再赋值给geometry参数。另外，name参数作为一个属性信息也被包含在Feature对象中。</p>
<p>构建了三个地理要素后，再把它们分别通过ol.source.Vector类的addFeature()方法加入到ol.source.Vector对象中，最后再通过ol.layer.Tile类构成矢量图层并一起加入到地图中。</p>
<p>除了直接构建，还可以通过url请求矢量数据源</p>
<h4 id="url请求矢量数据"><a href="#url请求矢量数据" class="headerlink" title="url请求矢量数据"></a>url请求矢量数据</h4><p>读取url设置的矢量数据源，需要通过解析器Format（即ol.format.Feature的子类）来解析各类矢量数据，如XML、Text、JSON、GML、KML、GPS、WFS、WKT、GeoJSON等地图数据。</p>
<p>解析器相关类的类结构图：</p>
<p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922144624.png" alt="img"></p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>url请求矢量数据<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">      <span class="comment">// 创建地图</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">            target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line">            layers: [</span><br><span class="line"><span class="javascript">                <span class="keyword">new</span> ol.layer.Tile(&#123;             <span class="comment">// 底图</span></span></span><br><span class="line"><span class="javascript">                    source: <span class="keyword">new</span> ol.source.OSM()</span></span><br><span class="line">                &#125;),</span><br><span class="line"><span class="javascript">                <span class="comment">// 再加载一个geojson的矢量地图</span></span></span><br><span class="line"><span class="javascript">                <span class="keyword">new</span> ol.layer.Vector(&#123;</span></span><br><span class="line"><span class="javascript">                    source: <span class="keyword">new</span> ol.source.Vector(&#123;</span></span><br><span class="line"><span class="javascript">                        url: <span class="string">&#x27;line.geojson&#x27;</span>,                <span class="comment">// 矢量数据来源</span></span></span><br><span class="line"><span class="javascript">                        format: <span class="keyword">new</span> ol.format.GeoJSON()                 <span class="comment">// 解析矢量数据的解析器</span></span></span><br><span class="line">                    &#125;)</span><br><span class="line">                &#125;)</span><br><span class="line">            ],</span><br><span class="line"><span class="javascript">            view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line">                center: [0, 0],</span><br><span class="line">                zoom: 0</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="样式设置"><a href="#样式设置" class="headerlink" title="样式设置"></a>样式设置</h4><p><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922145958.png" alt="image-20210922145957173"></p>
<p>代码如下：</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;UTF-8&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">&quot;X-UA-Compatible&quot;</span> <span class="attr">content</span>=<span class="string">&quot;IE=edge&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">&quot;viewport&quot;</span> <span class="attr">content</span>=<span class="string">&quot;width=device-width, initial-scale=1.0&quot;</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>样式设置<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  <span class="comment">&lt;!--引入ol.css 和 ol.js --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;css/ol.css&quot;</span>/&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;js/ol.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span> = <span class="string">&#x27;map&#x27;</span>&gt;</span><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="comment">// 初始化一个点要素</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> pointFeature = <span class="keyword">new</span> ol.Feature(&#123;</span></span><br><span class="line"><span class="javascript">          geometry: <span class="keyword">new</span> ol.geom.Point([<span class="number">12958998</span>, <span class="number">4852221</span>]),       <span class="comment">// 空间信息</span></span></span><br><span class="line"><span class="javascript">          name: <span class="string">&#x27;点要素&#x27;</span>                  <span class="comment">// 属性信息</span></span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化一个线要素</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> lineFeature = <span class="keyword">new</span> ol.Feature(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 空间信息</span></span></span><br><span class="line"><span class="javascript">          geometry: <span class="keyword">new</span> ol.geom.LineString([[<span class="number">11590147</span>, <span class="number">4322577</span>], [<span class="number">13594369</span>, <span class="number">3872784</span>]]),  </span></span><br><span class="line"><span class="javascript">          name: <span class="string">&#x27;线要素&#x27;</span>                  <span class="comment">// 属性信息</span></span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化一个多边形要素</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> polygonFeature = <span class="keyword">new</span> ol.Feature(&#123;</span></span><br><span class="line"><span class="javascript">          <span class="comment">// 空间信息</span></span></span><br><span class="line"><span class="javascript">          geometry: <span class="keyword">new</span> ol.geom.Polygon([[[<span class="number">11801814</span>, <span class="number">3251012</span>], [<span class="number">14057391</span>, <span class="number">2748303</span>], [<span class="number">12714628</span>, <span class="number">1346008</span>], [<span class="number">11801814</span>, <span class="number">3251012</span>]]]),</span></span><br><span class="line"><span class="javascript">          name: <span class="string">&#x27;多边形要素&#x27;</span>              <span class="comment">// 属性信息</span></span></span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化一个矢量数据源, 并添加上面创建的要素</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> vectorSource = <span class="keyword">new</span> ol.source.Vector();</span></span><br><span class="line">      vectorSource.addFeature(pointFeature);</span><br><span class="line">      vectorSource.addFeature(lineFeature);</span><br><span class="line">      vectorSource.addFeature(polygonFeature);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="comment">// 初始化一个矢量图层</span></span></span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> vectorLayer = <span class="keyword">new</span> ol.layer.Vector(&#123;</span></span><br><span class="line">          source: vectorSource,</span><br><span class="line"><span class="javascript">          style: <span class="keyword">new</span> ol.style.Style(&#123;                            <span class="comment">// 自定义矢量地图样式</span></span></span><br><span class="line"><span class="javascript">            stroke: <span class="keyword">new</span> ol.style.Stroke(&#123;</span></span><br><span class="line"><span class="javascript">                color: <span class="string">&#x27;red&#x27;</span>,</span></span><br><span class="line">                width: 5</span><br><span class="line">            &#125;)</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line"> </span><br><span class="line"><span class="javascript">      <span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span></span><br><span class="line"><span class="javascript">          target: <span class="string">&#x27;map&#x27;</span>,</span></span><br><span class="line">          layers: [</span><br><span class="line"><span class="javascript">              <span class="keyword">new</span> ol.layer.Tile(&#123;             <span class="comment">// 底图</span></span></span><br><span class="line"><span class="javascript">                  source: <span class="keyword">new</span> ol.source.OSM()</span></span><br><span class="line">              &#125;),</span><br><span class="line">              vectorLayer</span><br><span class="line">          ],</span><br><span class="line"><span class="javascript">          view: <span class="keyword">new</span> ol.View(&#123;</span></span><br><span class="line">              center: [0, 0],</span><br><span class="line">              zoom: 0</span><br><span class="line">          &#125;)</span><br><span class="line">      &#125;);</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>如果要在feature上设置样式，就必须先获取到所有加载的feature，然后依次设置，显然直接设置layer的样式，会在代码编写上更容易一些。</p>
<p>自带样式的矢量地图修改样式</p>
<p>有些矢量地图数据自带样式，比如KML格式的矢量地图，如果要修改样式，则相对比较麻烦。得分情况考虑：</p>
<ul>
<li>一种是所有矢量地图都不使用自带的样式：</li>
</ul>
<ul>
<li>一种是部分矢量地图不使用自带的样式。</li>
</ul>
<p>对于第一种情况，则相对比较简单一点，只需要把ol.format.KML的构造参数extractStyles设置为false即可，然后为layer设定自定义的样式。</p>
<p>对于第二种情况，则相对麻烦一些，必须要读取加载的所有feature，并进行过滤，对符合条件的feature重新设置样式。</p>
<h1 id="API"><a href="#API" class="headerlink" title="API"></a>API</h1><p><a target="_blank" rel="noopener" href="https://segmentfault.com/a/1190000020297846">参考文章</a></p>
<h2 id="map（地图）"><a href="#map（地图）" class="headerlink" title="map（地图）"></a>map（地图）</h2><h3 id="创建基本地图"><a href="#创建基本地图" class="headerlink" title="创建基本地图"></a>创建基本地图</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> map = <span class="keyword">new</span> ol.Map(&#123;</span><br><span class="line">    target: <span class="string">&#x27;map&#x27;</span>,<span class="comment">//对象指向</span></span><br><span class="line">    layers: [<span class="comment">//图层</span></span><br><span class="line">      <span class="keyword">new</span> ol.layer.Tile(&#123;<span class="comment">//这里定义的是平铺图层</span></span><br><span class="line">        source: <span class="keyword">new</span> ol.source.OSM()<span class="comment">//图层源 定义图层映射协议</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    view: <span class="keyword">new</span> ol.View(&#123;<span class="comment">//视图</span></span><br><span class="line">      center: ol.proj.fromLonLat([<span class="number">37.41</span>, <span class="number">8.82</span>]),<span class="comment">//地图中心</span></span><br><span class="line">      zoom: <span class="number">4</span><span class="comment">//缩放层级</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="属性选项"><a href="#属性选项" class="headerlink" title="属性选项"></a>属性选项</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.Map(&#123;</span><br><span class="line">    target: <span class="string">&#x27;map&#x27;</span>,<span class="comment">//对象映射：要将`map`对象附加到div，` map`对象将`target`作为参数，值是`div`的`id`</span></span><br><span class="line">    layers: [<span class="comment">//图层</span></span><br><span class="line">      <span class="keyword">new</span> ol.layer.Tile(&#123;<span class="comment">//这里定义的是平铺图层</span></span><br><span class="line">        source: <span class="keyword">new</span> ol.source.OSM()<span class="comment">//图层源 定义图层映射协议</span></span><br><span class="line">      &#125;)</span><br><span class="line">    ],</span><br><span class="line">    view: <span class="keyword">new</span> ol.View(&#123;<span class="comment">//视图</span></span><br><span class="line">      center: ol.proj.fromLonLat([<span class="number">37.41</span>, <span class="number">8.82</span>]),<span class="comment">//地图中心</span></span><br><span class="line">      zoom: <span class="number">4</span><span class="comment">//缩放层级</span></span><br><span class="line">    &#125;),</span><br><span class="line">    controls:[<span class="comment">//最初添加到映射中的控件  如未设置 使用默认控件</span></span><br><span class="line">        <span class="keyword">new</span> ol.control.Control(&#123;</span><br><span class="line">            element:,<span class="comment">//元素是控件的容器元素(DOM)。只有在开发自定义控件时才需要指定这一点</span></span><br><span class="line">            render: ,<span class="comment">//控件重新呈现时调用的函数</span></span><br><span class="line">            target: <span class="comment">//如果想在映射的视图端口之外呈现控件，指定目标</span></span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    interactions:[<span class="comment">//最初添加到映射中的交互 如未设置 使用默认交互</span></span><br><span class="line">        <span class="keyword">new</span> ol.interaction.Interaction(&#123;</span><br><span class="line">            handleEvent</span><br><span class="line">        &#125;)</span><br><span class="line">    ],</span><br><span class="line">    overlays:[</span><br><span class="line">        <span class="keyword">new</span> ol.Overlay()</span><br><span class="line">    ],</span><br><span class="line">    maxTilesLoading:<span class="number">16</span>,<span class="comment">//同时加载的最大瓷砖数 默认16</span></span><br><span class="line">    loadTilesWhileAnimating:<span class="literal">false</span>,<span class="comment">//</span></span><br><span class="line">    loadTilesWhileInteracting:<span class="literal">false</span>,<span class="comment">//   </span></span><br><span class="line">    moveTolerance:<span class="number">1</span>,<span class="comment">//光标必须移动的最小距离(以像素为单位)才能被检测为map move事件，而不是单击。增加这个值可以使单击地图变得更容易</span></span><br><span class="line">    pixelRatio:<span class="built_in">window</span>.devicePixelRatio,<span class="comment">//</span></span><br><span class="line">    keyboardEventTarget:,<span class="comment">//要监听键盘事件的元素</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="地图事件"><a href="#地图事件" class="headerlink" title="地图事件"></a>地图事件</h3><table>
<thead>
<tr>
<th>地图事件</th>
<th>含义</th>
</tr>
</thead>
<tbody><tr>
<td>click</td>
<td>无拖动单击</td>
</tr>
<tr>
<td>dblclick</td>
<td>无拖动双击</td>
</tr>
<tr>
<td>moveend</td>
<td>移动地图结束时</td>
</tr>
<tr>
<td>movestart</td>
<td>移动地图开始时</td>
</tr>
<tr>
<td>pointerdrag</td>
<td>当拖动指针时触发</td>
</tr>
<tr>
<td>pointermove</td>
<td>当指针移动时触发。注意，在触摸设备上，这是在地图平移时触发的，因此与<code>mousemove</code>不同</td>
</tr>
<tr>
<td>postcompose</td>
<td></td>
</tr>
<tr>
<td>postrender</td>
<td>在映射帧呈现后触发</td>
</tr>
<tr>
<td>precompose</td>
<td></td>
</tr>
<tr>
<td>propertychange</td>
<td>当属性被更改时触发</td>
</tr>
<tr>
<td>rendercomplete</td>
<td>渲染完成时触发，即当前视图的所有源和tile都已加载完毕，所有tile都将淡出</td>
</tr>
<tr>
<td>singleclick</td>
<td>一个真正的无拖放和无双击的单击。注意，这个事件被延迟了250毫秒，以确保它不是双击</td>
</tr>
</tbody></table>
<h3 id="map的方法"><a href="#map的方法" class="headerlink" title="map的方法"></a>map的方法</h3><table>
<thead>
<tr>
<th>地图方法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>addControl(control)</td>
<td>将给定的控件添加到地图中</td>
</tr>
<tr>
<td>removeControl(control)</td>
<td>从地图中移除已给定的控件</td>
</tr>
<tr>
<td>addInteraction(interaction)</td>
<td>将给定的交互添加到地图中</td>
</tr>
<tr>
<td>removeInteraction(interaction)</td>
<td>从地图中移除已给定的交互</td>
</tr>
<tr>
<td>addLayer(layer)</td>
<td>将给定的图层添加到地图的顶部</td>
</tr>
<tr>
<td>removeLayer(layer)</td>
<td>从地图中移除已给定的图层</td>
</tr>
<tr>
<td>addOverlay(overlay)</td>
<td>将给定的叠加层添加到地图中</td>
</tr>
<tr>
<td>removeOverlay(overlay)</td>
<td>从地图中移除已给定的叠加层</td>
</tr>
<tr>
<td>forEachFeatureAtPixel(pixel, callback, opt_options)</td>
<td>检测与视图端口上的像素相交的特性，并对每个相交的特性执行回调。检测中包含的层可以通过<code>opt_options</code>中的<code>layerFilter</code>选项配置</td>
</tr>
<tr>
<td>forEachLayerAtPixel(pixel, callback, opt_options)</td>
<td>检测在视图端口上的像素处具有颜色值的层，并对每个匹配的层执行回调。检测中包含的层可以通过<code>opt_layerFilter</code>配置</td>
</tr>
<tr>
<td>getControls()</td>
<td>获取地图控件</td>
</tr>
<tr>
<td>getCoordinateFromPixel(pixel)</td>
<td>获取给定像素的坐标。这将返回地图视图投影中的坐标。</td>
</tr>
<tr>
<td>getEventCoordinate(event)</td>
<td>返回浏览器事件的视图投影中的坐标</td>
</tr>
<tr>
<td>getEventPixel(event)</td>
<td>返回浏览器事件相对于视图端口的地图像素位置</td>
</tr>
<tr>
<td>getFeaturesAtPixel(pixel, opt_options)</td>
<td>获取视图端口上与像素相交的所有特性</td>
</tr>
<tr>
<td>getInteractions()</td>
<td>获取地图交互</td>
</tr>
<tr>
<td>getLayerGroup()</td>
<td>获取与此地图关联的图层组</td>
</tr>
<tr>
<td>setLayerGroup(layerGroup)</td>
<td>设置与此地图关联的图层组</td>
</tr>
<tr>
<td>getLayers()</td>
<td>获取与此地图关联的图层的集合</td>
</tr>
<tr>
<td>getOverlayById(id)</td>
<td>通过其标识符获取覆盖(<code>overlay. getId()</code>返回的值)。注意，索引将字符串和数字标识符视为相同的。<code>getoverlaybyid(2)</code>将返回id为2或2的叠加层。</td>
</tr>
<tr>
<td>getOverlays()</td>
<td>获得地图叠加</td>
</tr>
<tr>
<td>getPixelFromCoordinate(coordinate)</td>
<td>获取坐标的像素。它接受地图视图投影中的坐标并返回相应的像素</td>
</tr>
<tr>
<td>getSize()</td>
<td>获取地图尺寸</td>
</tr>
<tr>
<td>setSize(size)</td>
<td>设置地图尺寸</td>
</tr>
<tr>
<td>getTarget()</td>
<td>获取呈现此映射的目标。注意，这将返回作为选项或<code>setTarget</code>中输入的内容。如果这是一个元素，它将返回一个元素;如果是字符串，它会返回这个字符串</td>
</tr>
<tr>
<td>getTargetElement()</td>
<td>获取呈现此映射的<code>DOM</code>元素。与<code>getTarget</code>相反，这个方法总是返回一个元素，如果映射没有目标，则返回<code>null</code></td>
</tr>
<tr>
<td>getView()</td>
<td>获取地图视图。视图管理中心和分辨率等属性。</td>
</tr>
<tr>
<td>setView(view)</td>
<td>设置地图视图</td>
</tr>
<tr>
<td>getViewport()</td>
<td>获取作为<code>map</code>视图端口的元素</td>
</tr>
<tr>
<td>hasFeatureAtPixel(pixel, opt_options)</td>
<td>检测在<code>viewport</code>上是否与一个像素相交。可以通过<code>opt_layerFilter</code>配置在检测中包含的层。</td>
</tr>
</tbody></table>
<h2 id="Layers（图层）"><a href="#Layers（图层）" class="headerlink" title="Layers（图层）"></a>Layers（图层）</h2><p>定义图层：地图图层<code>layers:[...]</code>组定义映射中可用的图层组，用来盛放地图上的各种元素，其在地图上的显示顺序是按照数组中元素序列从下到上呈现的，可以直接在创建地图时定义图层，多个图层的时候可以单独定义。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> layer = <span class="keyword">new</span> ol.layer.Vector(&#123;<span class="comment">//这里定义的是图层类型(Image/Title/Vector)</span></span><br><span class="line">    source:<span class="keyword">new</span> ol.source.Vector(),<span class="comment">//矢量图层源  源是用于获取映射块的协议【必须】</span></span><br><span class="line">    style:[],<span class="comment">//图层样式 【必须】</span></span><br><span class="line">    feature:[],<span class="comment">//图层元素 【必须】</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>添加指定图层：<code>map.addLayer(layer)</code>；</li>
<li>移除指定图层：<code>map.removeLayer(layer)</code>；</li>
</ul>
<p>图层是轻量级容器，从数据源<code>Source</code>获取数据。</p>
<p><code>Source</code>d子类分别有，分别对应不同图层类：</p>
<ul>
<li><code>ol.source.ImageSource()</code></li>
<li><code>ol.source.TileSource()</code></li>
<li><code>ol.source.VectorSource()</code></li>
</ul>
<p><code>Source</code>主要有以下属性选项：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.source.VectorSource(&#123;</span><br><span class="line">    attributions:,<span class="comment">//</span></span><br><span class="line">    attributionsCollapsible:,<span class="comment">//布尔值  默认为true </span></span><br><span class="line">    projection:,<span class="comment">//投影系</span></span><br><span class="line">    state:<span class="string">&#x27;ready&#x27;</span>,<span class="comment">//默认为&#x27;ready&#x27;</span></span><br><span class="line">    wrapX:<span class="literal">false</span>,<span class="comment">//默认为false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>ol.layer.Tile()</code>和<code>ol.layer.Image()</code>图层类都具有相同的属性如下：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.layer.Tile/Image(&#123;<span class="comment">//以下为图层的属性选项， 都可设置，所以皆有getter/setter</span></span><br><span class="line">    opacity:<span class="number">2</span>,<span class="comment">//透明度 区间范围为(0, 1) 默认为1</span></span><br><span class="line">    visible:<span class="literal">true</span>,<span class="comment">//显示属性 布尔值 默认为true</span></span><br><span class="line">    extent:[],<span class="comment">//图层渲染的边界范围。该层将不会在此范围之外呈现</span></span><br><span class="line">    zIndex:<span class="number">2</span>,<span class="comment">//图层渲染的索引层级。在渲染时，图层将被排序，首先是z-idnex，然后是位置，当为undefined时，对于添加到映射的layers集合中的层，zIndex为0，或者当使用该层的setMap()方法时，zIndex为无穷大</span></span><br><span class="line">    minResolution:<span class="number">3</span>,<span class="comment">//该层可见的最小分辨率(包括在内)</span></span><br><span class="line">    maxResolution:<span class="number">6</span>,<span class="comment">//该层可见的最大分辨率（包括在内）</span></span><br><span class="line">    repload:<span class="number">0</span>,<span class="comment">//预加载。将低分辨率瓦片加载到预加载级别。0表示没有预加载 默认为0</span></span><br><span class="line">    source:<span class="keyword">new</span> ol.source.TileSource()/ImageSource(),<span class="comment">//图层源</span></span><br><span class="line">    map:  ,<span class="comment">//把图层覆盖在地图上，地图不会在它的图层集合中管理这个图层，这个图层将被呈现在顶部，这对于临时层非常有用。</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h3 id="1-ol-layer-Tile"><a href="#1-ol-layer-Tile" class="headerlink" title="(1)ol.layer.Tile()"></a>(1)<code>ol.layer.Tile()</code></h3><p>平铺图层。</p>
<p>对于提供预呈现、平铺的网格图像的层源，这些网格按特定分辨率的缩放级别组织。</p>
<h3 id="2-ol-layer-Image"><a href="#2-ol-layer-Image" class="headerlink" title="(2)ol.layer.Image()"></a>(2)<code>ol.layer.Image()</code></h3><p>图像图层。</p>
<p>服务器呈现的映像，可用于任意范围和分辨率。</p>
<h3 id="3-ol-layer-Vector"><a href="#3-ol-layer-Vector" class="headerlink" title="(3)ol.layer.Vector()"></a>(3)<code>ol.layer.Vector()</code></h3><p>矢量图层。</p>
<p>在客户端呈现矢量数据，其属性具备<code>getter</code>和<code>setter</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.layer.Vector(&#123;<span class="comment">//以下为图层的属性选项， 都可设置，所以皆有getter/setter</span></span><br><span class="line">    opacity:<span class="number">2</span>,<span class="comment">//透明度 区间范围为(0, 1) 默认为1</span></span><br><span class="line">    visible:<span class="literal">true</span>,<span class="comment">//显示属性 布尔值 默认为true</span></span><br><span class="line">    extent:[],<span class="comment">//图层渲染的边界范围。该层将不会在此范围之外呈现</span></span><br><span class="line">    zIndex:<span class="number">2</span>,<span class="comment">//图层渲染的索引层级。在渲染时，图层将被排序，首先是z-idnex，然后是位置，当为undefined时，对于添加到映射的layers集合中的层，zIndex为0，或者当使用该层的setMap()方法时，zIndex为无穷大</span></span><br><span class="line">    minResolution:<span class="number">3</span>,<span class="comment">//该层可见的最小分辨率(包括在内)</span></span><br><span class="line">    maxResolution:<span class="number">6</span>,<span class="comment">//该层可见的最大分辨率（包括在内）</span></span><br><span class="line">    renderOrder:,<span class="comment">//呈现顺序。函数用于在呈现前对特性进行排序。默认情况下，特性是按照创建它们的顺序绘制的。使用null来避免排序，但是得到一个未定义的绘制顺序</span></span><br><span class="line">    renderBuffer:<span class="number">100</span>,<span class="comment">//默认为100 缓冲区</span></span><br><span class="line">    renderMode:<span class="string">&#x27;vector&#x27;</span>,<span class="comment">//默认为&#x27;vector&#x27; 矢量图层的渲染模式</span></span><br><span class="line">    source:<span class="keyword">new</span> ol.source.VectorSource(),<span class="comment">//图层源</span></span><br><span class="line">    map:  ,<span class="comment">//把图层覆盖在地图上，地图不会在它的图层集合中管理这个图层，这个图层将被呈现在顶部，这对于临时层非常有用</span></span><br><span class="line">    declutter:<span class="literal">false</span>,<span class="comment">//默认为false 整理图片和文字。清理应用于所有图像和文本样式，优先级由样式的z-index定义。z-index指数越低，优先级越高</span></span><br><span class="line">    style:<span class="keyword">new</span> ol.style.Style(),<span class="comment">//图层样式</span></span><br><span class="line">    updateWhileAnimating:<span class="literal">false</span>,<span class="comment">//默认为false </span></span><br><span class="line">    updateWhileInteracting:<span class="literal">false</span>,<span class="comment">//默认为false</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p>其中渲染模式有两种：</p>
<ul>
<li><code>&#39;image&#39;</code>：矢量图层被渲染为图像。性能很好，但是点符号和文本总是随着视图旋转，像素在缩放动画中缩放</li>
<li><code>&#39;vector&#39;</code>：矢量图层被呈现为向量。即使在动画期间也有最准确的渲染，但性能较慢</li>
</ul>
<h4 id="1-Feature"><a href="#1-Feature" class="headerlink" title="1)Feature"></a>1)Feature</h4><p>用于地理特征的矢量元素，具有几何<code>geometry()</code>和其他属性，类似于矢量文件格式(如<code>GeoJSON</code>)中的特性。</p>
<ul>
<li>添加矢量元素：通过<code>vectorsource().addFeature(feature)</code>添加到矢量图层上。</li>
<li>移除图层所有的矢量元素：<code>vectorsource().clear()</code></li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> feature = <span class="keyword">new</span> ol.Feature(&#123;</span><br><span class="line">  geometry: <span class="keyword">new</span> ol.geom.Polygon(polyCoords),</span><br><span class="line">  labelPoint: <span class="keyword">new</span> ol.geom.Point(labelCoords),</span><br><span class="line">  style:<span class="keyword">new</span> ol.style.Style(&#123;&#125;),</span><br><span class="line">  name: <span class="string">&#x27;My Polygon&#x27;</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<ul>
<li><p>定义矢量元素：<code>new ol.Feature()</code>，；</p>
</li>
<li><p>矢量元素样式：</p>
<ul>
<li>设置样式：<code>new ol.style.Style()</code>，也可以使用<code>feature.setStyle(style)</code>，未定义的话，可以使用它的盛放容器<code>layer</code>的样式；</li>
<li>获取样式：<code>feature.getStyle()</code></li>
</ul>
</li>
<li><p>一个<code>feature</code>只有一个默认几何属性<code>geometry</code>，可以有任意数量的命名几何图形：</p>
<ul>
<li>获取默认几何属性：<code>feature.getGeometry()</code>；</li>
<li>设置几何属性：<code>feature.setGeometry(geometry)</code>；</li>
<li>设置几何属性名：<code>feature.setGeometryName(name)</code>；</li>
<li>矢量元素要呈现的几何图形的特征属性、几何图形或函数由<code>geometry</code>属性选项设定，主要有以下几种子类模块：<ul>
<li><code>ol.geom.Circle()</code>：圆形</li>
<li><code>ol.geom.Geometry()</code>：几何图形</li>
<li><code>ol.geom.GeometryCollection()</code>：</li>
<li><code>ol.geom.LinearRing()</code>：环线</li>
<li><code>ol.geom.LineString()</code>：线段</li>
<li><code>ol.geom.Point()</code>：点</li>
<li><code>ol.geom.Polygon()</code>：多边形</li>
<li><code>ol.geom.MultiLineString()</code></li>
<li><code>ol.geom.MultiPoint()</code></li>
<li><code>ol.geom.MultiPolygon()</code></li>
<li><code>ol.geom.SimpleGeometry()</code></li>
</ul>
</li>
</ul>
</li>
<li><p><code>feature</code>的稳定标识符<code>ID</code>：</p>
<ul>
<li>设置<code>feature</code>的<code>id</code>：<code>feature.setId(id)</code>，当<code>id</code>可能相同时，可以这样加以区分</li>
</ul>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">feature.setId(id + <span class="string">&quot;featureName&quot;</span>);</span><br></pre></td></tr></table></figure>

<ul>
<li>获取<code>feature</code>的<code>id</code>：<code>vector.getSource().getFeatureById()</code>或者<code>vectorsource().getFeatureById()</code></li>
</ul>
</li>
<li><p><code>feature</code>的<code>set(key, value, opt_silent)</code>：</p>
<ul>
<li>设置<code>key</code>：<code>feature.set(&quot;keyName&quot;,name)</code>，<code>keyName</code>是字符串，自己根据情况设置</li>
<li>获取<code>key</code>：之前设置的什么，就获取什么，<code>feature.get(&quot;keyName&quot;)</code>，会得到设置的值</li>
</ul>
</li>
</ul>
<h4 id="2-Style"><a href="#2-Style" class="headerlink" title="2)Style"></a>2)Style</h4><p>矢量特征呈现样式的容器。在重新呈现使用样式的特性或图层之前，通过<code>set*()</code>方法对样式及其子元素所做的任何更改都不会生效。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.style.Style(&#123;</span><br><span class="line">    geometry:<span class="keyword">new</span> ol.geom.LineString(),<span class="comment">//有以上ol.geom模块的几何图形可以参考</span></span><br><span class="line">    fill:<span class="keyword">new</span> ol.style.Fill(&#123;<span class="comment">//填充样式</span></span><br><span class="line">        color:color<span class="comment">//颜色、渐变或图案</span></span><br><span class="line">    &#125;),</span><br><span class="line">    </span><br><span class="line">    image:<span class="keyword">new</span> ol.style.Image(&#123;<span class="comment">//图像</span></span><br><span class="line">        opacity:,<span class="comment">//数值</span></span><br><span class="line">        rotateWithView:,<span class="comment">//布尔值</span></span><br><span class="line">        rotation:,<span class="comment">//数值</span></span><br><span class="line">        scale:<span class="comment">//数值</span></span><br><span class="line">    &#125;),</span><br><span class="line">    </span><br><span class="line">    image:<span class="keyword">new</span> ol.style.Icon(&#123;<span class="comment">//可以使用图片资源</span></span><br><span class="line">        anchor:[<span class="number">0.5</span>，<span class="number">0.5</span>]，<span class="comment">//锚。默认值是图标中心 默认值是[0.5,0.5]</span></span><br><span class="line">        anchorOrigin:<span class="string">&#x27;top-left&#x27;</span>,<span class="comment">//锚的原点:左下角、右下角、左上方或右上方。默认是左上</span></span><br><span class="line">        anchorXUnits:<span class="string">&#x27;fraction&#x27;</span>,<span class="comment">//指定锚点x值的单位。&#x27;fraction&#x27;的值表示x值是图标的&#x27;fraction&#x27;。&#x27;pixels&#x27;的值表示像素中的x值,默认为&#x27;fraction&#x27;</span></span><br><span class="line">        anchorYUnits:<span class="string">&#x27;fraction&#x27;</span>,<span class="comment">//指定锚点y值的单位。&#x27;fraction&#x27;的值表示y值是图标的&#x27;fraction&#x27;。&#x27;pixels&#x27;的值表示像素中的y值,默认为&#x27;fraction&#x27;</span></span><br><span class="line">        color:color,<span class="comment">//颜色、渐变或图案</span></span><br><span class="line">        crossOrigin:,</span><br><span class="line">        img:,<span class="comment">//图标的图像对象  如果没有提供src选项，则必须已经加载了提供的图像</span></span><br><span class="line">        imgSize:,<span class="comment">//</span></span><br><span class="line">        offset:[<span class="number">0</span>,<span class="number">0</span>].<span class="comment">//偏移值，默认为[0,0]</span></span><br><span class="line">        offsetOrigin:<span class="string">&#x27;top-left&#x27;</span>,<span class="comment">//偏移量的原点，bottom-left, bottom-right, top-left or top-right. 默认是`top-left`</span></span><br><span class="line">        opacity:<span class="number">1</span>,<span class="comment">//默认是1  （0，1）</span></span><br><span class="line">        scale:<span class="number">1</span>,<span class="comment">//默认是1</span></span><br><span class="line">        rotation：<span class="number">0</span>，<span class="comment">//以弧度旋转(顺时针方向正旋转) 默认为0</span></span><br><span class="line">        size：,<span class="comment">//图标大小(以像素为单位)。可与偏移量一起用于定义要从原点(sprite)图标图像使用的子矩形</span></span><br><span class="line">        src:<span class="string">&#x27;&#x27;</span>,<span class="comment">//图像URL源</span></span><br><span class="line">        rotateWithView：<span class="literal">false</span>,<span class="comment">//是否旋转视图中的图标  默认为false            </span></span><br><span class="line">    &#125;),</span><br><span class="line">    </span><br><span class="line">    stroke:<span class="keyword">new</span> ol.style.Stroke(&#123;<span class="comment">//描绘</span></span><br><span class="line">        width: ,<span class="comment">//宽</span></span><br><span class="line">        color:color,<span class="comment">//颜色、渐变或图案</span></span><br><span class="line">        lineCap:<span class="string">&#x27;round&#x27;</span>,<span class="comment">//线帽风格  butt, round, 或者 square 默认 round</span></span><br><span class="line">        lineJoin:<span class="string">&#x27;round&#x27;</span>,<span class="comment">//线连接方式 bevel, round, 或者 miter 默认 round</span></span><br><span class="line">        lineDash： []，<span class="comment">//线间隔模式 这个变化与分辨率有关 默认为undefined Internet Explorer 10和更低版本不支持</span></span><br><span class="line">        lineDashOffset:<span class="number">0</span>,<span class="comment">//线段间隔偏移 默认0</span></span><br><span class="line">        miterLimit:<span class="number">10</span>,<span class="comment">// 默认10                   </span></span><br><span class="line">    &#125;),</span><br><span class="line">        </span><br><span class="line">    text:<span class="keyword">new</span> ol.style.Text(&#123;<span class="comment">//文字</span></span><br><span class="line">        font:<span class="string">&#x27;&#x27;</span>,<span class="comment">//默认是&#x27;10px sans-serif&#x27;</span></span><br><span class="line">        text:<span class="string">&#x27;&#x27;</span>,<span class="comment">//文本内容</span></span><br><span class="line">        textAlign：<span class="string">&#x27;center&#x27;</span>,<span class="comment">//文本对齐 &#x27;left&#x27;, &#x27;right&#x27;, &#x27;center&#x27;, &#x27;end&#x27; &#x27;start&#x27;.针对于placement: &#x27;point&#x27;,默认为&#x27;center&#x27;；针对于placement: &#x27;line&#x27;，默认是让渲染器选择不超过maxAngle的位置</span></span><br><span class="line">        textBaseline:<span class="string">&#x27;middle&#x27;</span>,<span class="comment">//文本基线  &#x27;bottom&#x27;, &#x27;top&#x27;, &#x27;middle&#x27;, &#x27;alphabetic&#x27;, &#x27;hanging&#x27;, &#x27;ideographic&#x27; 默认&#x27;middle&#x27;</span></span><br><span class="line">        placement:<span class="string">&#x27;&#x27;</span>,<span class="comment">//文本布置</span></span><br><span class="line">        scale：，</span><br><span class="line">        padding:[<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>,<span class="number">0</span>],<span class="comment">//文本周围的像素填充。数组中值的顺序是[top, right, bottom, left]</span></span><br><span class="line">        fill:<span class="keyword">new</span> ol.style.Fill(),<span class="comment">//如果未设置，默认未#333</span></span><br><span class="line">        stroke:<span class="keyword">new</span> ol.style.Stroke(),</span><br><span class="line">        offsetX:<span class="number">0</span>,<span class="comment">//水平文本偏移量(以像素为单位)。正值将把文本右移。默认0</span></span><br><span class="line">        offsetY:<span class="number">0</span>,<span class="comment">//垂直文本偏移量(以像素为单位)。正值会将文本向下移动。默认0</span></span><br><span class="line">        rotation：<span class="number">0</span>，<span class="comment">//默认0</span></span><br><span class="line">        rotateWithView:<span class="literal">false</span>,</span><br><span class="line">        backgroundFill:  ,<span class="comment">//当placement:“point”时，填充文本背景的样式。默认为无填充 </span></span><br><span class="line">        backgroundStroke: ,<span class="comment">//当placement:“point”时，描绘文本背景的样式。默认为无描绘</span></span><br><span class="line">    &#125;),</span><br><span class="line">    </span><br><span class="line">    zIndex:,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<p><code>ol.geom.Geomtry()</code>是矢量几何对象的抽象基类，通常只用于创建子类，而不是在应用程序中实例化。它的方法如下：</p>
<table>
<thead>
<tr>
<th>方法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>set(key, value)</td>
<td>设置值。<code>key</code>：关键名字（字符串）；<code>value</code>：值</td>
</tr>
<tr>
<td>get(key)</td>
<td>获取值</td>
</tr>
<tr>
<td>setProperties(values, opt_silent)</td>
<td>设置键值对的集合。注意，这将更改任何现有属性并添加新属性(它不会删除任何现有属性)。</td>
</tr>
<tr>
<td>getProperties()</td>
<td>获取一个包含所有属性名和值的对象</td>
</tr>
<tr>
<td>getClosestPoint(point, opt_closestPoint)</td>
<td>将几何图形的最近点作为坐标返回到经过的点</td>
</tr>
<tr>
<td>getExtent(opt_extent)</td>
<td>获取几何的范围</td>
</tr>
<tr>
<td>getKeys()</td>
<td>获取对象属性名称列表</td>
</tr>
<tr>
<td>getRevision()</td>
<td>获取此对象的版本号。每次修改对象时，它的版本号都会增加。</td>
</tr>
<tr>
<td>intersectsCoordinate(coordinate)</td>
<td>如果该几何图形包含指定的坐标，则返回<code>true</code>。如果坐标位于几何图形的边界上，则返回<code>false</code></td>
</tr>
<tr>
<td>rotate(angle, anchor)</td>
<td>围绕给定的坐标旋转几何图形。这将修改现有的几何坐标</td>
</tr>
<tr>
<td>scale(sx, opt_sy, opt_anchor)</td>
<td>缩放几何图形(可选原点)。这将修改现有的几何坐标。sx<code>：x方向上的缩放因子；</code>sy<code>：Y轴上的缩放因子；</code>opt_anchor`：缩放原点(默认为几何范围的中心)</td>
</tr>
<tr>
<td>simplify(tolerance)</td>
<td>创建这个几何图形的简化版本</td>
</tr>
<tr>
<td>transform(source, destination)</td>
<td>将圆的每个坐标从一个坐标系变换到另一个坐标系。在适当的位置修改几何图形。如果不想修改几何图形，请首先<code>clone()</code>它，然后在克隆上使用此函数。在内部，一个圆目前由两点表示:圆心<code>[cx, cy]</code>和圆心右边的点<code>[cx + r, cy]</code>。这个<code>transform</code>函数只变换这两点。所以得到的几何形状也是一个圆，而这个圆并不等同于通过变换原圆的每一点得到的形状</td>
</tr>
<tr>
<td>translate(deltaX, deltaY)</td>
<td>翻转几何图形。这将修改现有的几何坐标。如果您想要一个新的几何体，那么首先<code>clone()</code>这个几何体</td>
</tr>
</tbody></table>
<p>以下是<code>ol.geom.Geomtry</code>抽象基类创建的常见<a target="_blank" rel="noopener" href="https://link.segmentfault.com/?url=https://openlayers.org/en/latest/apidoc/module-ol_geom_SimpleGeometry-SimpleGeometry.html">子类模块</a>：</p>
<h5 id="1）ol-geom-Circle"><a href="#1）ol-geom-Circle" class="headerlink" title="1）ol.geom.Circle()"></a>1）ol.geom.Circle()</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.geom.Circle(&#123;</span><br><span class="line">    center:[],<span class="comment">//中心点</span></span><br><span class="line">    radius:<span class="number">2</span>,<span class="comment">//圆半径</span></span><br><span class="line">    layout:<span class="comment">//布局</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>方法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>applyTransform(transformFn)</td>
<td>对几何图形的每个坐标应用一个变换函数。在适当的位置修改几何图形。如果不想修改几何图形，请首先<code>clone()</code>它，然后在克隆上使用此函数</td>
</tr>
<tr>
<td>clone()</td>
<td>把几何图形复制一份</td>
</tr>
<tr>
<td>getCenter()</td>
<td>返回中心坐标</td>
</tr>
<tr>
<td>getFirstCoordinate()</td>
<td>返回几何图形的第一个坐标</td>
</tr>
<tr>
<td>getLastCoordinate()</td>
<td>返回几何图形的最后一个坐标</td>
</tr>
<tr>
<td>getLayout()</td>
<td>返回几何图形的<code>layout</code></td>
</tr>
<tr>
<td>getRadius()</td>
<td>返回圆的半径</td>
</tr>
<tr>
<td>getType()</td>
<td>获取这个几何图形的类型</td>
</tr>
<tr>
<td>intersectsExtent(extent)</td>
<td>测试几何形状和经过的区域是否相交，返回布尔值</td>
</tr>
<tr>
<td>rotate(angle, anchor)</td>
<td>围绕给定的坐标旋转几何图形。这将修改现有的几何坐标。<code>angle</code>：以弧度为单位的旋转角度；<code>anchor</code>：旋转中心</td>
</tr>
<tr>
<td>scale(sx, opt_sy, opt_anchor)</td>
<td>缩放几何图形(可选原点)。这将修改现有的几何坐标。<code>sx</code>：x方向上的缩放因子；<code>sy</code>：Y轴上的缩放因子；<code>opt_anchor</code>：缩放原点(默认为几何范围的中心)</td>
</tr>
<tr>
<td>setCenter(center)</td>
<td>将圆心设置为<code>coordinate</code></td>
</tr>
<tr>
<td>setCenterAndRadius(center, radius, opt_layout)</td>
<td>设置圆的中心(<code>coordinate</code>)和半径(<code>number</code>)</td>
</tr>
<tr>
<td>setRadius(radius)</td>
<td>设置圆的半径。半径的单位是投影的单位。</td>
</tr>
<tr>
<td>transform(source, destination)</td>
<td>将圆的每个坐标从一个坐标系变换到另一个坐标系。在适当的位置修改几何图形。如果不想修改几何图形，请首先<code>clone()</code>它，然后在克隆上使用此函数。在内部，一个圆目前由两点表示:圆心<code>[cx, cy]</code>和圆心右边的点<code>[cx + r, cy]</code>。这个<code>transform</code>函数只变换这两点。所以得到的几何形状也是一个，而这个圆并不等同于通过变换原圆的每一点得到的形状</td>
</tr>
<tr>
<td>translate(deltaX, deltaY)</td>
<td>f翻转几何图形。这将修改现有的几何坐标。如果您想要一个新的几何体，那么首先<code>clone()</code>这个几何体</td>
</tr>
</tbody></table>
<h5 id="2）ol-geom-LineString-coordinates-opt-layout"><a href="#2）ol-geom-LineString-coordinates-opt-layout" class="headerlink" title="2）ol.geom.LineString(coordinates, opt_layout)"></a>2）ol.geom.LineString(coordinates, opt_layout)</h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.geom.LineString(&#123;</span><br><span class="line">    coordinate:[],<span class="comment">//坐标。对于内部使用，平面坐标结合opt_layout也可以接受</span></span><br><span class="line">    layout: <span class="comment">//Layout</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>



<table>
<thead>
<tr>
<th>方法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>appendCoordinate(coordinate)</td>
<td>将经过的坐标追加到<code>linestring</code>的坐标里</td>
</tr>
<tr>
<td>applyTransform(transformFn)</td>
<td>对几何图形的每个坐标应用一个变换函数。在适当的位置修改几何图形。如果不想修改几何图形，请首先<code>clone()</code>它，然后在克隆上使用此函数</td>
</tr>
<tr>
<td>clone()</td>
<td>把几何图形复制一份</td>
</tr>
<tr>
<td>forEachSegment(callback)</td>
<td>遍历每条线段，调用提供的回调函数。如果回调函数返回一个真值，则函数立即返回该值。否则函数返回<code>false</code></td>
</tr>
<tr>
<td>getCoordinateAt(fraction, opt_dest)</td>
<td>沿着线段返回给定部分的坐标。<code>fraction</code>是一个介于0和1之间的数字，其中0是线段的开始，1是线段的末尾</td>
</tr>
<tr>
<td>getCoordinates()</td>
<td>返回线段的坐标</td>
</tr>
<tr>
<td>setCoordinates(coordinates, opt_layout)</td>
<td>s设置线段的坐标</td>
</tr>
<tr>
<td>getFirstCoordinate()</td>
<td>返回几何图形的第一个坐标</td>
</tr>
<tr>
<td>getLastCoordinate()</td>
<td>返回几何图形的最后一个坐标</td>
</tr>
<tr>
<td>getLayout()</td>
<td>返回几何图形的<code>Layout</code></td>
</tr>
<tr>
<td>getLength()</td>
<td>在投影平面上返回线段的长度</td>
</tr>
<tr>
<td>getType()</td>
<td>得到这个几何图形的类型</td>
</tr>
<tr>
<td>intersectsExtent(extent)</td>
<td>测试几何形状和通过的范围是否相交</td>
</tr>
<tr>
<td>rotate(angle, anchor)</td>
<td>围绕给定的坐标旋转几何图形。这将修改现有的几何坐标</td>
</tr>
<tr>
<td>scale(sx, opt_sy, opt_anchor)</td>
<td>缩放几何图形(可选原点)。这将修改现有的几何坐标。sx<code>：x方向上的缩放因子；</code>sy<code>：Y轴上的缩放因子；</code>opt_anchor`：缩放原点(默认为几何范围的中心)</td>
</tr>
<tr>
<td>translate(deltaX, deltaY)</td>
<td>翻转几何图形。这将修改现有的几何坐标。如果您想要一个新的几何体，那么首先<code>clone()</code>这个几何体</td>
</tr>
</tbody></table>
<h5 id="3）-ol-geom-Point-coordinates-opt-layout"><a href="#3）-ol-geom-Point-coordinates-opt-layout" class="headerlink" title="3）)ol.geom.Point(coordinates, opt_layout)"></a>3）)<code>ol.geom.Point(coordinates, opt_layout)</code></h5><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.geom.Point()</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>方法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>applyTransform(transformFn)</td>
<td>对几何图形的每个坐标应用一个变换函数。在适当的位置修改几何图形。如果不想修改几何图形，请首先<code>clone()</code>它，然后在克隆上使用此函数</td>
</tr>
<tr>
<td>clone()</td>
<td>把几何图形复制一份</td>
</tr>
<tr>
<td>getCoordinates()</td>
<td>返回点的坐标</td>
</tr>
<tr>
<td>setCoordinates(coordinates, opt_layout)</td>
<td>设置点的坐标</td>
</tr>
<tr>
<td>getFirstCoordinate()</td>
<td>返回几何图形的第一个坐标</td>
</tr>
<tr>
<td>getLastCoordinate()</td>
<td>返回几何图形的最后一个坐标</td>
</tr>
<tr>
<td>getLayout()</td>
<td>返回几何图形的<code>Layout</code></td>
</tr>
<tr>
<td>getType()</td>
<td>得到这个几何图形的类型</td>
</tr>
<tr>
<td>intersectsExtent(extent)</td>
<td>测试几何形状和通过的范围是否相交</td>
</tr>
<tr>
<td>rotate(angle, anchor)</td>
<td>围绕给定的坐标旋转几何图形。这将修改现有的几何坐标</td>
</tr>
<tr>
<td>scale(sx, opt_sy, opt_anchor)</td>
<td>缩放几何图形(可选原点)。这将修改现有的几何坐标。sx<code>：x方向上的缩放因子；</code>sy<code>：Y轴上的缩放因子；</code>opt_anchor`：缩放原点(默认为几何范围的中心)</td>
</tr>
<tr>
<td>translate(deltaX, deltaY)</td>
<td>翻转几何图形。这将修改现有的几何坐标。如果您想要一个新的几何体，那么首先<code>clone()</code>这个几何体</td>
</tr>
</tbody></table>
<p>4）ol.geom.Polygon()</p>
<p>多边形几何图形。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.geom.Polygon(&#123;</span><br><span class="line">    coordinates:[],<span class="comment">//定义多边形的线性环的数组</span></span><br><span class="line">    layout:,</span><br><span class="line">    ends:[],<span class="comment">//末端（平面坐标内部使用）</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>方法</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>applyTransform(transformFn)</td>
<td>对几何图形的每个坐标应用一个变换函数。在适当的位置修改几何图形。如果不想修改几何图形，请首先<code>clone()</code>它，然后在克隆上使用此函数</td>
</tr>
<tr>
<td>appendLinearRing(linearRing)</td>
<td>在多边形上追加线性环</td>
</tr>
<tr>
<td>clone()</td>
<td>把几何图形复制一份</td>
</tr>
<tr>
<td>getCoordinates()</td>
<td>返回点的坐标</td>
</tr>
<tr>
<td>setCoordinates(coordinates, opt_layout)</td>
<td>设置点的坐标</td>
</tr>
<tr>
<td>getFirstCoordinate()</td>
<td>返回几何图形的第一个坐标</td>
</tr>
<tr>
<td>getLastCoordinate()</td>
<td>返回几何图形的最后一个坐标</td>
</tr>
<tr>
<td>getInteriorPoint()</td>
<td>返回多边形的内部点</td>
</tr>
<tr>
<td>getLinearRing(index)</td>
<td>返回多边形几何的第n个线性环。如果给定索引超出范围，则返回null。外部线性环在索引0处可用，而内部环在索引1及以上处可用</td>
</tr>
<tr>
<td>getLinearRings()</td>
<td>返回多边形的线性环</td>
</tr>
<tr>
<td>getLinearRingCount()</td>
<td>返回多边形的环数，这包括外部环和任何内部环</td>
</tr>
<tr>
<td>getLayout()</td>
<td>返回几何图形的<code>Layout</code></td>
</tr>
<tr>
<td>getType()</td>
<td>得到这个几何图形的类型</td>
</tr>
<tr>
<td>getArea()</td>
<td>返回投影平面上多边形的面积</td>
</tr>
<tr>
<td>intersectsExtent(extent)</td>
<td>测试几何形状和通过的范围是否相交</td>
</tr>
<tr>
<td>rotate(angle, anchor)</td>
<td>围绕给定的坐标旋转几何图形。这将修改现有的几何坐标</td>
</tr>
<tr>
<td>scale(sx, opt_sy, opt_anchor)</td>
<td>缩放几何图形(可选原点)。这将修改现有的几何坐标。sx<code>：x方向上的缩放因子；</code>sy<code>：Y轴上的缩放因子；</code>opt_anchor`：缩放原点(默认为几何范围的中心)</td>
</tr>
<tr>
<td>translate(deltaX, deltaY)</td>
<td>翻转几何图形。这将修改现有的几何坐标。如果您想要一个新的几何体，那么首先<code>clone()</code>这个几何体</td>
</tr>
</tbody></table>
<h5 id="4）ol-layer-VectorTile"><a href="#4）ol-layer-VectorTile" class="headerlink" title="4）ol.layer.VectorTile()"></a>4）<code>ol.layer.VectorTile()</code></h5><p>矢量平铺图层。</p>
<p>图层用于客户端呈现矢量平铺数据。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">new</span> ol.layer.Vector(&#123;<span class="comment">//以下为图层的属性选项， 都可设置，所以皆有getter/setter</span></span><br><span class="line">    opacity:<span class="number">2</span>,<span class="comment">//透明度 区间范围为(0, 1) 默认为1</span></span><br><span class="line">    visible:<span class="literal">true</span>,<span class="comment">//显示属性 布尔值 默认为true</span></span><br><span class="line">    extent:[],<span class="comment">//图层渲染的边界范围。该层将不会在此范围之外呈现</span></span><br><span class="line">    zIndex:<span class="number">2</span>,<span class="comment">//图层渲染的索引层级。在渲染时，图层将被排序，首先是z-idnex，然后是位置，当为undefined时，对于添加到映射的layers集合中的层，zIndex为0，或者当使用该层的setMap()方法时，zIndex为无穷大</span></span><br><span class="line">    minResolution:<span class="number">3</span>,<span class="comment">//该层可见的最小分辨率(包括在内)</span></span><br><span class="line">    maxResolution:<span class="number">6</span>,<span class="comment">//该层可见的最大分辨率（包括在内）</span></span><br><span class="line">    renderOrder:,<span class="comment">//呈现顺序。函数用于在呈现前对特性进行排序。默认情况下，特性是按照创建它们的顺序绘制的。使用null来避免排序，但是得到一个未定义的绘制顺序</span></span><br><span class="line">    renderBuffer:<span class="number">100</span>,<span class="comment">//默认为100 缓冲区</span></span><br><span class="line">    renderMode:<span class="string">&#x27;vector&#x27;</span>,<span class="comment">//默认为&#x27;vector&#x27; 矢量图层的渲染模式</span></span><br><span class="line">    source:<span class="keyword">new</span> ol.source.VectorSource(),<span class="comment">//图层源</span></span><br><span class="line">    map:  ,<span class="comment">//把图层覆盖在地图上，地图不会在它的图层集合中管理这个图层，这个图层将被呈现在顶部，这对于临时层非常有用</span></span><br><span class="line">    declutter:<span class="literal">false</span>,<span class="comment">//默认为false 整理图片和文字。清理应用于所有图像和文本样式，优先级由样式的z-index定义。z-index指数越低，优先级越高</span></span><br><span class="line">    style:<span class="keyword">new</span> ol.style.Style(),<span class="comment">//图层样式</span></span><br><span class="line">    updateWhileAnimating:<span class="literal">false</span>,<span class="comment">//默认为false </span></span><br><span class="line">    updateWhileInteracting:<span class="literal">false</span>,<span class="comment">//默认为false</span></span><br><span class="line">    preload:,<span class="comment">//</span></span><br><span class="line">    renderOrder:,<span class="comment">//</span></span><br><span class="line">    useInterimTilesOnError:<span class="literal">true</span>,<span class="comment">//错误时使用临时贴片 默认true</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="view（视图）"><a href="#view（视图）" class="headerlink" title="view（视图）"></a>view（视图）</h2><p>设置视图<code>view</code>由三种状态决定：<code>center</code>中心、<code>resolution</code>分辨率、<code>rotation</code>旋转，每个状态都有相应的<code>getter</code>和<code>setter</code>。</p>
<p>可以在视图里定义地图中心点、层级、分辨率、旋转以及地图投影等。</p>
<p>视图对象受到约束，主要有<strong>分辨率约束、旋转约束、中心约束</strong>。</p>
<ul>
<li><p><strong>分辨率约束</strong></p>
<p>切换到特定分辨率时，特定分辨率主要由以下选项决定：<code>resolutions</code>、<code>maxResolution</code>、<code>maxZoom</code>、<code>zoomFactor</code>。如果已经设置<code>resolutions</code>，其他选项就可忽略。</p>
</li>
<li><p><strong>旋转约束</strong></p>
<p>会切换到特定的角度。它由以下选项决定:<code>enableRotation</code>和<code>constrainRotation</code>。在默认情况下，当接近水平线时，旋转值会突然变为零。</p>
</li>
<li><p><strong>中心约束</strong></p>
<p>由范围选项决定。默认情况下，中心完全不受约束。</p>
</li>
</ul>
<h3 id="1-视图选项"><a href="#1-视图选项" class="headerlink" title="1)视图选项"></a>1)视图选项</h3><h4 id="1）中心点center"><a href="#1）中心点center" class="headerlink" title="1）中心点center"></a>1）中心点center</h4><p>视图的初始中心，中心的坐标系由投影<code>projection</code>指定，如果未设置此参数，则不会获取层源，但是之后可以使用<code>#setCenter</code>设置中心。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> center = ol.proj.fromLonLat([longitude, latitude]);<span class="comment">//未限制地图范围时</span></span><br><span class="line"><span class="keyword">let</span> center = ol.proj.transform([minX, minY, maxX, maxY]，<span class="string">&#x27;EPSG:4326&#x27;</span>, <span class="string">&#x27;EPSG:3857&#x27;</span>);<span class="comment">//限制地图显示范围时设置中心点  X代表经度， Y代表纬度</span></span><br></pre></td></tr></table></figure>

<h4 id="2）投影projection"><a href="#2）投影projection" class="headerlink" title="2）投影projection"></a>2）投影<code>projection</code></h4><p>视图拥有<code>projection</code>投影，投影决定了中心的坐标系，其单位决定了分辨率的单位(每个像素的投影单位)。默认投影为球面墨卡托(<code>EPSG:3857</code>)。</p>
<ul>
<li>获取投影：<code>map.getView().getProjection()</code></li>
<li>设置投影：<code>map.getView().setProjection()</code></li>
</ul>
<h4 id="3）分辨率resolution"><a href="#3）分辨率resolution" class="headerlink" title="3）分辨率resolution"></a>3）分辨率<code>resolution</code></h4><p>视图的初始分辨率，单位是每像素的投影单位(例如米每像素)。</p>
<p>另一种方法是设置缩放<code>zoom</code>。缩放可以设置：最大层级<code>maxZoom</code>、最小层级<code>minZoom</code>以及当前层级<code>zoom</code></p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> view = <span class="keyword">new</span> ol.View(&#123;</span><br><span class="line">    <span class="comment">// center: center,</span></span><br><span class="line">    zoom: curZoom,</span><br><span class="line">    minZoom: minZoom,</span><br><span class="line">    maxZoom: maxZoom,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>

<ul>
<li>获取分辨率：<code>map.getView().getResolution()</code></li>
<li>获取给定范围(以映射单元为单位)和大小(以像素为单位)的分辨率：<code>map.getView().getResolutionForExtent(extent, opt_size)</code>；</li>
<li>获取缩放级别的分辨率：<code>map.getView().getResolutionForZoom(zoom)</code>；</li>
<li>获取视图最大值分辨率：<code>map.getView().getMaxResolution()</code>；</li>
<li>获取视图最小值分辨率：<code>map.getView().getMinResolution()</code>；</li>
<li>设置分辨率：<code>map.getView().setResolution(resolution)</code></li>
</ul>
<h4 id="4）旋转rotation"><a href="#4）旋转rotation" class="headerlink" title="4）旋转rotation"></a>4）旋转<code>rotation</code></h4><p>初始旋转角度为弧度(正顺时针旋转，0表示向北)。</p>
<ul>
<li>获取旋转调用方法<code>map.getView().getRotation()</code>；</li>
<li>设置旋转调用方法<code>map.getView().setRotation(rotation);</code></li>
</ul>
<h4 id="5-缩放zoom"><a href="#5-缩放zoom" class="headerlink" title="5)缩放zoom"></a>5)缩放<code>zoom</code></h4><p>仅在未定义分辨率时使用。</p>
<p>缩放级别用于计算视图的初始分辨率。初始分辨率是使用<code>#constrainResolution</code>方法确定的。</p>
<ul>
<li>获取缩放层级：<code>map.getView().getZoom()</code>；</li>
<li>获取最大缩放层级：<code>map.getView().getMaxZoom()</code>；</li>
<li>获取最小缩放层级：<code>map.getView().getMinZoom()</code>；</li>
<li>获取缩放层级的分辨率：<code>map.getView().getZoomForResolution(resolution)</code>；</li>
<li>设置缩放层级：<code>map.getView().setZoom(zoom)</code>；</li>
<li>设置最大缩放层级：<code>map.getView().setMaxZoom(zoom)</code>；</li>
<li>设置最小缩放层级：<code>map.getView().setMinZoom(zoom)</code>；</li>
</ul>
<h4 id="6-旋转约束constrainRotation"><a href="#6-旋转约束constrainRotation" class="headerlink" title="6)旋转约束constrainRotation"></a>6)旋转约束<code>constrainRotation</code></h4><p>旋转约束。<code>false</code>为未约束，<code>true</code>为未约束但是接近于0。数字限制了旋转到该值的数量。</p>
<h4 id="7-启用旋转enableRotation"><a href="#7-启用旋转enableRotation" class="headerlink" title="7)启用旋转enableRotation"></a>7)启用旋转<code>enableRotation</code></h4><p>如果为<code>false</code>，则始终使用将旋转设置为零的旋转约束。如果启用为<code>false</code>，则没有效果。</p>
<h4 id="8-约束范围extent"><a href="#8-约束范围extent" class="headerlink" title="8)约束范围extent"></a>8)约束范围<code>extent</code></h4><p>中心点不能超出这个范围。</p>
<h3 id="2）视图方法"><a href="#2）视图方法" class="headerlink" title="2）视图方法"></a>2）视图方法</h3><h4 id="1）动画"><a href="#1）动画" class="headerlink" title="1）动画"></a>1）动画</h4><blockquote>
<p>单个动画</p>
</blockquote>
<p>动画视图。视图的中心、缩放(或分辨率)和旋转可以通过动画来实现视图状态之间的平滑转换。</p>
<p>默认情况下，动画持续时间为1秒，并且类型为<code>in-and-out easing</code>。</p>
<p>通过设置持续时间<code>duration</code>(以毫秒为单位)和缓动选项<code>easing</code>(参见模块:<a target="_blank" rel="noopener" href="https://link.segmentfault.com/?url=https://openlayers.org/en/latest/apidoc/module-ol_easing.html">ol/easing</a>)来定制此行为。</p>
<p><code>easing</code>:</p>
<ul>
<li><code>easeIn</code>：平缓加速</li>
<li><code>easeOut</code>：平缓减速</li>
<li><code>inAndOut</code>：平缓开始，先加速，再减速</li>
<li><code>linear</code>：匀速</li>
<li><code>upAndDown</code>：平缓开始，加速，最后再减速。这与模块的一般行为相同:<code>ol/easing~inAndOut</code>，但是最终的减速被延迟了</li>
</ul>
<blockquote>
<p>多个动画</p>
</blockquote>
<p>要将多个动画连接在一起，请使用多个动画对象调用该方法。</p>
<p>如果提供一个函数作为<code>animate</code>方法的最后一个参数，它将在动画系列的末尾被调用。</p>
<p>如果动画系列独立完成，回调函数将被调用<code>true</code>;如果动画系列被取消，回调函数将被调用<code>false</code>。</p>
<h4 id="2）取消动画cancelAnimations"><a href="#2）取消动画cancelAnimations" class="headerlink" title="2）取消动画cancelAnimations()"></a>2）取消动画<code>cancelAnimations()</code></h4><p>取消任何正在进行的动画。</p>
<h4 id="3）getAnimating"><a href="#3）getAnimating" class="headerlink" title="3）getAnimating()"></a>3）<code>getAnimating()</code></h4><p>确定视图是否处于动画状态。返回布尔值。</p>
<h4 id="4）计算范围calculateExtent-opt-size"><a href="#4）计算范围calculateExtent-opt-size" class="headerlink" title="4）计算范围calculateExtent(opt_size)"></a>4）计算范围<code>calculateExtent(opt_size)</code></h4><p>计算当前视图状态的范围和传递的大小。<code>opt_size</code>指盒子像素尺寸，如未提供，将使用此视图的第一个映射的大小。</p>
<p>尺寸是盒子的像素尺寸，计算的范围应该与之匹配。</p>
<p>想要获取整个底图映射的范围，使用<code>map.getSize()</code></p>
<h4 id="5）centerOn-coordinate-size-position"><a href="#5）centerOn-coordinate-size-position" class="headerlink" title="5）centerOn(coordinate, size, position)"></a>5）<code>centerOn(coordinate, size, position)</code></h4><p>以坐标和视图位置为中心。</p>
<ul>
<li><code>coordinate</code>：坐标点</li>
<li><code>size</code>：盒子像素尺寸</li>
<li><code>position</code>：视图的居中位置</li>
</ul>
<h2 id="interaction-交互"><a href="#interaction-交互" class="headerlink" title="interaction(交互)"></a><code>interaction</code>(交互)</h2><p>通常只用于创建子类，而不在应用程序中实例化。</p>
<p>用于更改映射状态的用户操作。有些类似于控件，但不与<code>DOM</code>元素关联。</p>
<p>虽然交互没有<code>DOM</code>元素，但是它们中的一些会呈现向量，因此在屏幕上是可见的。</p>
<p>添加交互动作使用：<code>map.addInteraction(interaction);</code></p>
<p><code>OpenLayers </code>中可实例化的子类及其功能如下：</p>
<table>
<thead>
<tr>
<th>可实例化子类</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>doubleclickzoom interaction</td>
<td>双击放大交互功能</td>
</tr>
<tr>
<td>draganddrop</td>
<td>以“拖文件到地图中”的交互添加图层</td>
</tr>
<tr>
<td>dragbox</td>
<td>拉框，用于划定一个矩形范围，常用于放大地图</td>
</tr>
<tr>
<td>dragpan</td>
<td>拖拽平移地图</td>
</tr>
<tr>
<td>dragrotateandzoom</td>
<td>拖拽方式进行缩放和旋转地图</td>
</tr>
<tr>
<td>dragrotate</td>
<td>拖拽方式旋转地图</td>
</tr>
<tr>
<td>dragzoom</td>
<td>拖拽方式缩放地图</td>
</tr>
<tr>
<td>draw</td>
<td>绘制地理要素功能</td>
</tr>
<tr>
<td>interaction defaults</td>
<td>默认添加的交互功能</td>
</tr>
<tr>
<td>keyboardpan</td>
<td>键盘方式平移地图</td>
</tr>
<tr>
<td>keyboardzoom</td>
<td>键盘方式缩放地图</td>
</tr>
<tr>
<td>select</td>
<td>选择要素功能</td>
</tr>
<tr>
<td>modify</td>
<td>更改要素</td>
</tr>
<tr>
<td>mousewheelzoom</td>
<td>鼠标滚轮缩放功能</td>
</tr>
<tr>
<td>pinchrotate</td>
<td>手指旋转地图，针对触摸屏</td>
</tr>
<tr>
<td>pinchzoom</td>
<td>手指进行缩放，针对触摸屏</td>
</tr>
<tr>
<td>pointer</td>
<td>鼠标的用户自定义事件基类</td>
</tr>
<tr>
<td>snap</td>
<td>鼠标捕捉，当鼠标距离某个要素一定距离之内，自动吸附到要素</td>
</tr>
</tbody></table>
<h3 id="1）默认交互功能ol-interaction-defaylts"><a href="#1）默认交互功能ol-interaction-defaylts" class="headerlink" title="1）默认交互功能ol.interaction.defaylts()"></a>1）默认交互功能<code>ol.interaction.defaylts()</code></h3><p>主要是最为常用的功能，如缩放、平移和旋转地图等，具体功能有如下这些：</p>
<table>
<thead>
<tr>
<th>默认交互</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>ol.interaction.DragRotate</td>
<td>鼠标拖拽旋转，一般配合一个键盘按键辅助</td>
</tr>
<tr>
<td>ol.interaction.DragZoom</td>
<td>鼠标拖拽缩放，一般配合一个键盘按键辅助</td>
</tr>
<tr>
<td>ol.interaction.DoubleClickZoom</td>
<td>鼠标或手指双击缩放地图</td>
</tr>
<tr>
<td>ol.interaction.PinchRotate</td>
<td>两个手指旋转地图，针对触摸屏</td>
</tr>
<tr>
<td>ol.interaction.PinchZoom</td>
<td>两个手指缩放地图，针对触摸屏</td>
</tr>
<tr>
<td>ol.interaction.DragPan</td>
<td>鼠标或手指拖拽平移地图</td>
</tr>
<tr>
<td>ol.interaction.KeyboardZoom</td>
<td>使用键盘 <code>+</code> 和 <code>-</code> 按键进行缩放</td>
</tr>
<tr>
<td>ol.interaction.KeyboardPan</td>
<td>使用键盘方向键平移地图</td>
</tr>
<tr>
<td>ol.interaction.MouseWheelZoom</td>
<td>鼠标滚轮缩放地图</td>
</tr>
</tbody></table>
<h3 id="2）针对矢量图层元素的交互功能"><a href="#2）针对矢量图层元素的交互功能" class="headerlink" title="2）针对矢量图层元素的交互功能"></a>2）针对矢量图层元素的交互功能</h3><h4 id="1）选择ol-interaction-Select"><a href="#1）选择ol-interaction-Select" class="headerlink" title="1）选择ol.interaction.Select()"></a>1）选择<code>ol.interaction.Select()</code></h4><p>选择矢量元素的交互功能。</p>
<p>默认情况下，所选矢量元素的样式不相同，因此这种交互可以用于可视化高亮显示，以及为其他操作(如修改或输出)选择特性。</p>
<p>选定的矢量元素将被添加到内部非托管图层。</p>
<p>有三种方式控制矢量元素的选择：</p>
<ul>
<li>使用由<code>condition</code>定义的浏览器事件和<code>toggle</code>切换的<code>add</code>/<code>remove</code>以及<code>multi</code>选项</li>
<li>一个<code>layer</code>过滤器</li>
<li>一个使用<code>filter</code>选项的进一步矢量元素过滤器</li>
</ul>
<h4 id="2）绘制ol-interaction-Draw"><a href="#2）绘制ol-interaction-Draw" class="headerlink" title="2）绘制ol.interaction.Draw()"></a>2）绘制<code>ol.interaction.Draw()</code></h4><p>用于绘制特征几何图形的交互功能。</p>
<p>绘制交互允许绘制几何地理要素，可选一个参数为对象，可包含参数如下：</p>
<ul>
<li><code>features</code>：绘制的要素的目标集合；</li>
<li><code>source</code>：绘制的要素的目标图层源；</li>
<li><code>snapTolerance</code>：自动吸附完成点的像素距离，也就是说当鼠标位置距离闭合点小于该值设置的时候，会自动吸附到闭合点，默认值是 <code>12</code>；</li>
<li><code>type</code>：绘制的地理要素类型，<code>ol.geom.GeometryType</code>类型，包含 <code>Point</code>、 <code>LineString</code>、 <code>Polygon</code>、<code>MultiPoint</code>、<code>MultiLineString</code> 或者 <code>MultiPolygon</code>；</li>
<li><code>minPointsPerRing</code>：绘制一个多边形需要的点数最小值，数值类型，默认是 <code>3</code>；</li>
<li><code>style</code>：要素素描的样式；</li>
<li><code>geometryName</code>：绘制的地理要素的名称，<code>string</code>类型</li>
</ul>
<h4 id="3-修改ol-interaction-Modify"><a href="#3-修改ol-interaction-Modify" class="headerlink" title="3)修改ol.interaction.Modify()"></a>3)修改<code>ol.interaction.Modify()</code></h4><p>用于修改矢量元素几何图形的交互功能。</p>
<p>若想修改已添加到存在的矢量源中的矢量元素，需要使用<code>modify</code>选项构建修改交互动作。</p>
<p>如若想修改集合中的矢量元素（比如用选择交互的集合），需要使用<code>features</code>选项构建交互。该交互必须使用<code>source</code>或者<code>features</code>构建。</p>
<p>默认情况下，当按下<code>alt</code>键时，交互允许删除顶点。想要使用不同的删除条件配置交互，请使用<code>deleteCondition</code>选项。</p>
<h2 id="controler-控件"><a href="#controler-控件" class="headerlink" title="controler(控件)"></a>controler(控件)</h2><p>控件是一个可见的小部件，其DOM元素位于屏幕上的固定位置。它们可以包含用户输入(按钮)，或者只是提供信息;位置是使用CSS确定的。这是一个虚基类，不负责实例化特定的控件。</p>
<p>默认情况下，这些元素被放置在具有CSS类名称<code>ol-overlaycontainer-stopevent</code>的容器中，但是可以使用任何外部DOM元素。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> myControl = <span class="keyword">new</span> ol.control.Control(&#123;<span class="comment">//定义一个控件</span></span><br><span class="line">    element:myElement</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">//然后添加到地图上</span></span><br><span class="line">map.addControl(myControl);</span><br></pre></td></tr></table></figure>

<p>主要的属性选项有：</p>
<ul>
<li><code>element</code>：DOM元素，元素是控件的容器元素。只有在开发自定义控件时才需要指定这一点</li>
<li><code>render</code>：重新呈现控件时调用的函数。这在<code>requestAnimationFrame</code>回调中调用</li>
<li><code>target</code>：DOM元素，想要控件在映射的视图端口之外呈现，需要指定目标对象</li>
</ul>
<p>其中包含的控件有：</p>
<table>
<thead>
<tr>
<th>控件</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>controldefaults</td>
<td>地图默认包含的控件，包含缩放控件和旋转控件</td>
</tr>
<tr>
<td>fullscreencontrol</td>
<td>全屏控件，用于全屏幕查看地图</td>
</tr>
<tr>
<td>mousepositioncontrol</td>
<td>鼠标位置控件，显示鼠标所在地图位置的坐标，可以自定义投影</td>
</tr>
<tr>
<td>overviewmapcontrol</td>
<td>地图全局视图控件</td>
</tr>
<tr>
<td>rotatecontrol</td>
<td>地图旋转控件</td>
</tr>
<tr>
<td>scalelinecontrol</td>
<td>比例尺控件</td>
</tr>
<tr>
<td>zoomcontrol</td>
<td>缩放控件</td>
</tr>
<tr>
<td>zoomslidercontrol</td>
<td>缩放刻度控件</td>
</tr>
<tr>
<td>zoomtoextentcontrol</td>
<td>缩放到全局控件</td>
</tr>
</tbody></table>
<h2 id="overlay-叠加层"><a href="#overlay-叠加层" class="headerlink" title="overlay(叠加层)"></a>overlay(叠加层)</h2><p>要显示在地图上方并附加到单个地图位置的元素。与控件不同的是，它们不在屏幕上的固定位置，而是绑定到地理坐标上，因此平移地图将移动 <code>overlay</code> ，而不是控件。</p>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;popup&quot;</span>&gt;</span></span><br><span class="line">        </span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> popup = <span class="keyword">new</span> ol.Overlay(&#123;</span><br><span class="line">    element:<span class="built_in">document</span>.getElementById(<span class="string">&#x27;popup&#x27;</span>),</span><br><span class="line">    ...</span><br><span class="line">&#125;);</span><br><span class="line">popup.setPosition(coordinate);</span><br><span class="line">map.addOverlay(popup);</span><br></pre></td></tr></table></figure>

<h3 id="Overlay选项"><a href="#Overlay选项" class="headerlink" title="Overlay选项"></a><strong>Overlay选项</strong></h3><h4 id="1-id"><a href="#1-id" class="headerlink" title="(1)id"></a>(1)<code>id</code></h4><p>设置 <code>overlay</code>的 <code>id</code>，字符串类型。</p>
<ul>
<li>获取<code>id</code>：<code>map.getOverlayById(id)</code>或者<code>overlay.getId()</code></li>
</ul>
<h4 id="2-element"><a href="#2-element" class="headerlink" title="(2)element"></a>(2)<code>element</code></h4><p><code>overlay</code> 元素，<code>DOM</code>元素</p>
<ul>
<li>获取：<code>overlay.getElement()</code></li>
<li>设置：<code>overlay.setElement(element)</code></li>
</ul>
<h4 id="3-offset"><a href="#3-offset" class="headerlink" title="(3)offset"></a>(3)<code>offset</code></h4><p>偏移量(以像素为单位)，用于定位 <code>overlay</code> ，数组类型，默认为[0, 0]：</p>
<ul>
<li>数组第一个元素为水平偏移，正右负左；</li>
<li>数组第二个元素为垂直，正下负上；</li>
<li>获取偏移值：<code>overlay.getOffset()</code></li>
<li>设置偏移值：<code>overlay.setOffset(offset)</code></li>
</ul>
<h4 id="4-position"><a href="#4-position" class="headerlink" title="(4)position"></a>(4)<code>position</code></h4><p>地图投影中的位置。</p>
<ul>
<li>获取：<code>overlay.getPosition()</code></li>
<li>设置：<code>overlay.setPosition(position)</code>，如果位置未定义<code>undefined</code>，则覆盖被隐藏。</li>
</ul>
<h4 id="5-positioning"><a href="#5-positioning" class="headerlink" title="(5)positioning"></a>(5)<code>positioning</code></h4><p>定义 <code>overlay</code> 相对于其位置属性的实际位置，默认为<code>top-left</code>，还有<code>&#39;bottom-left&#39;</code>, <code>&#39;bottom-center&#39;</code>, <code>&#39;bottom-right&#39;</code>, <code>&#39;center-left&#39;</code>, <code>&#39;center-center&#39;</code>, <code>&#39;center-right&#39;</code>, <code>&#39;top-left&#39;</code>,<code>&#39;top-center&#39;</code>, and <code>&#39;top-right&#39;</code>.</p>
<ul>
<li>获取：<code>overlay.getPositioning()</code></li>
<li>设置：<code>overlay.setPositioning(positioning)</code></li>
</ul>
<h4 id="6-autoPan"><a href="#6-autoPan" class="headerlink" title="(6)autoPan"></a>(6)<code>autoPan</code></h4><p>默认为<code>false</code>，如果设置为true，则在调用<code>setPosition</code>将平移映射，以便在当前视图中 <code>overlay</code> 完全可见。</p>
<h4 id="7-autoPanAnimation"><a href="#7-autoPanAnimation" class="headerlink" title="(7)autoPanAnimation"></a>(7)<code>autoPanAnimation</code></h4><p>动画选项用于平移 <code>overlay</code> 到视图中。此动画仅在启用<code>autoPan</code>时使用。可以提供一个持续时间和缓动来定制动画。</p>
<h4 id="8-stopEvent"><a href="#8-stopEvent" class="headerlink" title="(8)stopEvent"></a>(8)<code>stopEvent</code></h4><p>默认为<code>true</code>，是否应该停止到map视图端口的事件传播。</p>
<ul>
<li>如果为<code>true</code>，则将 <code>overlay</code> 放置在与控件相同的容器中（CSS class name<code>ol-overlaycontainer-stopevent</code>）</li>
<li>如果为<code>false</code>，它用<code>className</code>属性指定的<code>CSS</code>类名放置在容器中。</li>
</ul>
<h4 id="9-className"><a href="#9-className" class="headerlink" title="(9)className"></a>(9)<code>className</code></h4><p><code>CSS class name</code>.</p>
<h4 id="10-autoPanMargin"><a href="#10-autoPanMargin" class="headerlink" title="(10)autoPanMargin"></a>(10)<code>autoPanMargin</code></h4><p>地图自动平移时，地图边缘与 <code>overlay</code> 的留白（空隙），单位是像素，默认是 20像素</p>
<h2 id="Projections（投影）"><a href="#Projections（投影）" class="headerlink" title="Projections（投影）"></a>Projections（投影）</h2><p>需要给所有坐标和范围提供视图投影系（默认是<code>EPAG:3857</code>）。</p>
<p>转换投影系，使用<code>ol.proj.transform()</code>和<code>ol.proj.transformExtendt</code>进行转换</p>
<h3 id="1）、ol-proj"><a href="#1）、ol-proj" class="headerlink" title="(1）、ol.proj"></a>(1）、<code>ol.proj</code></h3><h4 id="1）ol-proj-addCoordinateTransforms-source-destination-forward-inverse"><a href="#1）ol-proj-addCoordinateTransforms-source-destination-forward-inverse" class="headerlink" title="1）ol.proj.addCoordinateTransforms(source, destination, forward, inverse)"></a>1）<code>ol.proj.addCoordinateTransforms(source, destination, forward, inverse)</code></h4><p>注册坐标转换函数来转换源投影和目标投影之间的坐标。正、反函数转换坐标对;此函数将这些转换为内部使用的处理区段和坐标数组的函数</p>
<ul>
<li><code>source</code>：源投影</li>
<li><code>destination</code>：目标投影</li>
<li><code>forward</code>：接受<code>ol</code>的正向变换函数(即从源投影到目标投影)。作为参数，并返回转换后的<code>ol.Coordinate</code></li>
<li><code>inverse</code>：接受<code>ol</code>的逆变换函数(即从目标投影到源投影)。作为参数，并返回转换后的<code>ol.Coordinate</code></li>
</ul>
<h4 id="2-ol-proj-addEquivalentProjections-projections"><a href="#2-ol-proj-addEquivalentProjections-projections" class="headerlink" title="2)ol.proj.addEquivalentProjections(projections)"></a>2)<code>ol.proj.addEquivalentProjections(projections)</code></h4><p>注册不改变坐标的转换函数。它们允许在具有相同含义的投影之间进行转换。</p>
<h4 id="3）ol-proj-addProjection-projection"><a href="#3）ol-proj-addProjection-projection" class="headerlink" title="3）ol.proj.addProjection(projection)"></a>3）<code>ol.proj.addProjection(projection)</code></h4><p>将投影对象添加到受支持的投影列表中，这些投影可以通过它们的<code>SRS</code>码进行查找。</p>
<h4 id="4-ol-proj-equivalent-projection1-projection2"><a href="#4-ol-proj-equivalent-projection1-projection2" class="headerlink" title="4)ol.proj.equivalent(projection1, projection2)"></a>4)<code>ol.proj.equivalent(projection1, projection2)</code></h4><p>检查两个投影是否相同，即一个投影中的每个坐标确实表示另一个投影中的相同地理点。</p>
<h4 id="5-ol-proj-fromLonLat-coordinate-opt-projection"><a href="#5-ol-proj-fromLonLat-coordinate-opt-projection" class="headerlink" title="5)ol.proj.fromLonLat(coordinate, opt_projection)"></a>5)<code>ol.proj.fromLonLat(coordinate, opt_projection)</code></h4><p>将经纬度坐标转换为不同的投影</p>
<ul>
<li><code>coordinate</code>：经纬度数组，经度在前，纬度在后</li>
<li><code>projection</code>：目标投影。默认是<code>Web Mercator</code>，即<code>“EPSG: 3857”</code></li>
</ul>
<h4 id="6-ol-proj-get-projectionLike"><a href="#6-ol-proj-get-projectionLike" class="headerlink" title="6)ol.proj.get(projectionLike)"></a>6)<code>ol.proj.get(projectionLike)</code></h4><p>获取指定代码的投影对象。</p>
<h4 id="7-ol-proj-getTransform-source-destination"><a href="#7-ol-proj-getTransform-source-destination" class="headerlink" title="7)ol.proj.getTransform(source, destination)"></a>7)<code>ol.proj.getTransform(source, destination)</code></h4><p>给定类似于投影的对象，搜索转换函数将坐标数组从源投影转换为目标投影。</p>
<h4 id="8-ol-proj-setProj4-proj4"><a href="#8-ol-proj-setProj4-proj4" class="headerlink" title="8)ol.proj.setProj4(proj4)"></a>8)<code>ol.proj.setProj4(proj4)</code></h4><p>proj4注册。如果没有显式注册，则假定proj4js将加载在全局名称空间中</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ol.proj.setProj4(proj4);</span><br></pre></td></tr></table></figure>

<h4 id="9-ol-proj-toLonLat-coordinate-opt-projection"><a href="#9-ol-proj-toLonLat-coordinate-opt-projection" class="headerlink" title="9)ol.proj.toLonLat(coordinate, opt_projection)"></a>9)<code>ol.proj.toLonLat(coordinate, opt_projection)</code></h4><p>将坐标转换为经度/纬度</p>
<ul>
<li><code>coordinate</code>：投影坐标</li>
<li><code>projection</code>：坐标的投影，默认是<code>Web Mercator</code>，即<code>“EPSG: 3857”</code></li>
</ul>
<h4 id="10-ol-proj-transform-coordinate-source-destination"><a href="#10-ol-proj-transform-coordinate-source-destination" class="headerlink" title="10)ol.proj.transform(coordinate, source, destination)"></a>10)<code>ol.proj.transform(coordinate, source, destination)</code></h4><p>将坐标从源投影转换为目标投影，这将返回一个新的坐标(并且不修改原始坐标)。</p>
<ul>
<li><code>coordinate</code>：坐标</li>
<li><code>source</code>：源投影</li>
<li><code>destination</code>：目标投影</li>
</ul>
<h4 id="11-ol-proj-transformExtent"><a href="#11-ol-proj-transformExtent" class="headerlink" title="11)ol.proj.transformExtent"></a>11)<code>ol.proj.transformExtent</code></h4><p>将范围从源投影转换为目标投影，这将返回一个新范围(并且不修改原始范围)。</p>
<h4 id="12-ol-proj-Units-string"><a href="#12-ol-proj-Units-string" class="headerlink" title="12)ol.proj.Units{string}"></a>12)<code>ol.proj.Units&#123;string&#125;</code></h4><p>投影单位：<code>&#39;degrees&#39;</code>, <code>&#39;ft&#39;</code>, <code>&#39;m&#39;</code>, <code>&#39;pixels&#39;</code>, <code>&#39;tile-pixels&#39;</code> or <code>&#39;us-ft&#39;</code></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:1909312602@qq.com">HeavenImmortal</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="https://heavenimtoral.gitee.io/2021/09/22/OpenLayers/">https://heavenimtoral.gitee.io/2021/09/22/OpenLayers/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a target="_blank" rel="noopener" href="https://creativecommons.org/licenses/by-nc-sa/4.0/">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/WebGis/">WebGis</a></div><div class="post_share"><div class="social-share" data-image="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152509.png" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2021/09/30/typeScript/"><img class="prev-cover" src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20211019161458.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Previous Post</div><div class="prev_info">TypeScript</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/16/geoServer/"><img class="next-cover" src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152323.png" onerror="onerror=null;src='/img/404.jpg'"><div class="pagination-info"><div class="label">Next Post</div><div class="next_info">geoServer</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> Related Articles</span></div><div class="relatedPosts-list"><div><a href="/2021/09/16/geoServer/" title="geoServer"><img class="cover" src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152323.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-16</div><div class="title">geoServer</div></div></a></div></div></div></div><div class="aside_content" id="aside_content"><div class="card-widget card-info"><div class="card-content"><div class="card-info-avatar is-center"><img class="avatar-img" src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/avatar.png" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/><div class="author-info__name">HeavenImmortal</div><div class="author-info__description">我苦苦的寻找，完美的代码究竟在哪里？</div></div><div class="card-info-data"><div class="card-info-data-item is-center"><a href="/archives/"><div class="headline">Articles</div><div class="length-num">44</div></a></div><div class="card-info-data-item is-center"><a href="/tags/"><div class="headline">Tags</div><div class="length-num">40</div></a></div><div class="card-info-data-item is-center"><a href="/categories/"><div class="headline">Categories</div><div class="length-num">9</div></a></div></div><a class="button--animated" id="card-info-btn" target="_blank" rel="noopener" href="https://github.com/xxxxxx"><i class="fab fa-github"></i><span>Follow Me</span></a><div class="card-info-social-icons is-center"><a class="social-icon" href="https://github.com/xxxxx" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:xxxxxx@gmail.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a></div></div></div><div class="card-widget card-announcement"><div class="card-content"><div class="item-headline"><i class="fas fa-bullhorn card-announcement-animation"></i><span>Announcement</span></div><div class="announcement_content">This is my Blog</div></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="card-content"><div class="item-headline"><i class="fas fa-stream"></i><span>Catalog</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#%E5%89%8D%E8%A8%80"><span class="toc-number">1.</span> <span class="toc-text">前言</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.</span> <span class="toc-text">介绍</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BB%8B%E7%BB%8D-1"><span class="toc-number">1.1.1.</span> <span class="toc-text">介绍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%89%B9%E5%BE%81"><span class="toc-number">1.1.2.</span> <span class="toc-text">特征</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%A1%86%E6%9E%B6%E7%BB%93%E6%9E%84"><span class="toc-number">1.1.3.</span> <span class="toc-text">框架结构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E7%B1%BB%E4%BB%8B%E7%BB%8D"><span class="toc-number">1.1.4.</span> <span class="toc-text">基本类介绍</span></a></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD%E5%AE%89%E8%A3%85"><span class="toc-number">2.</span> <span class="toc-text">下载安装</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E4%B8%8B%E8%BD%BD"><span class="toc-number">2.1.</span> <span class="toc-text">下载</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8"><span class="toc-number">3.</span> <span class="toc-text">使用</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%9E%84%E5%BB%BA%E7%AE%80%E5%8D%95%E7%9A%84%E5%9C%B0%E5%9B%BE%E5%BA%94%E7%94%A8"><span class="toc-number">3.1.</span> <span class="toc-text">构建简单的地图应用</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.</span> <span class="toc-text">控件</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#zoom%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.1.</span> <span class="toc-text">zoom控件</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9F%BA%E6%9C%AC%E4%BF%A1%E6%81%AF"><span class="toc-number">3.2.1.1.</span> <span class="toc-text">基本信息</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%BB%91%E5%9D%97%E7%BC%A9%E6%94%BE%E6%8E%A7%E4%BB%B6%EF%BC%88ol-control-ZoomSlider%EF%BC%89%E4%B8%8E%E7%BC%A9%E6%94%BE%E8%87%B3%E7%89%B9%E5%AE%9A%E5%9C%B0%E7%82%B9%E6%8E%A7%E4%BB%B6%EF%BC%88ol-control-ZoomToExtent%EF%BC%89"><span class="toc-number">3.2.1.2.</span> <span class="toc-text">滑块缩放控件（ol.control.ZoomSlider）与缩放至特定地点控件（ol.control.ZoomToExtent）</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%BD%92%E5%B1%9E%E6%8E%A7%E4%BB%B6%E4%B8%8E%E5%85%A8%E5%B1%8F%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.1.3.</span> <span class="toc-text">归属控件与全屏控件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%BD%92%E5%B1%9E%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.1.3.1.</span> <span class="toc-text">归属控件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%85%A8%E5%B1%8F%E6%8E%A7%E4%BB%B6%EF%BC%88ol-control-FullScreen%EF%BC%89"><span class="toc-number">3.2.1.3.2.</span> <span class="toc-text">全屏控件（ol.control.FullScreen）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E6%8B%BE%E5%8F%96%E6%8E%A7%E4%BB%B6%E4%B8%8E%E9%B9%B0%E7%9C%BC%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.1.4.</span> <span class="toc-text">坐标拾取控件与鹰眼控件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%9D%90%E6%A0%87%E6%8B%BE%E5%8F%96%EF%BC%88ol-control-MousePosition-%EF%BC%89"><span class="toc-number">3.2.1.4.1.</span> <span class="toc-text">坐标拾取（ol.control.MousePosition()）</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E9%B9%B0%E7%9C%BC%E6%8E%A7%E4%BB%B6-ol-control-OverviewMap"><span class="toc-number">3.2.1.4.2.</span> <span class="toc-text">鹰眼控件(ol.control.OverviewMap())</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E6%8E%A7%E4%BB%B6%E4%B8%8E%E6%AF%94%E4%BE%8B%E5%B0%BA%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.1.5.</span> <span class="toc-text">旋转控件与比例尺控件</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%97%8B%E8%BD%AC%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.1.5.1.</span> <span class="toc-text">旋转控件</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E6%AF%94%E4%BE%8B%E5%B0%BA%E6%8E%A7%E4%BB%B6%EF%BC%88ol-control-ScaleLine-%EF%BC%89"><span class="toc-number">3.2.1.5.2.</span> <span class="toc-text">比例尺控件（ol.control.ScaleLine()）</span></a></li></ol></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89%E5%88%87%E6%8D%A2%E5%9B%BE%E5%B1%82%E6%8E%A7%E4%BB%B6"><span class="toc-number">3.2.1.6.</span> <span class="toc-text">自定义切换图层控件</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#%E5%A4%9A%E6%BA%90%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.</span> <span class="toc-text">多源数据</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E6%95%B0%E6%8D%AE%E7%BB%84%E7%BB%87"><span class="toc-number">3.3.1.</span> <span class="toc-text">数据组织</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%93%A6%E7%89%87%E5%9C%B0%E5%9B%BE"><span class="toc-number">3.3.2.</span> <span class="toc-text">瓦片地图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%93%A6%E7%89%87%E5%9C%B0%E5%9B%BE-1"><span class="toc-number">3.3.2.1.</span> <span class="toc-text">瓦片地图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#LOD"><span class="toc-number">3.3.2.2.</span> <span class="toc-text">LOD</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%93%A6%E7%89%87%E8%AE%A1%E7%AE%97"><span class="toc-number">3.3.2.3.</span> <span class="toc-text">瓦片计算</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%86%E8%BE%A8%E7%8E%87"><span class="toc-number">3.3.3.</span> <span class="toc-text">分辨率</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B"><span class="toc-number">3.3.3.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#Web%E5%A2%A8%E5%8D%A1%E6%89%98%E6%8A%95%E5%BD%B1%E5%9D%90%E6%A0%87%E7%B3%BB%E4%B8%AD%E7%9A%84%E5%88%86%E8%BE%A8%E7%8E%87"><span class="toc-number">3.3.3.2.</span> <span class="toc-text">Web墨卡托投影坐标系中的分辨率</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenLayers%E9%BB%98%E8%AE%A4%E4%BD%BF%E7%94%A8%E7%9A%84%E5%88%86%E8%BE%A8%E7%8E%87"><span class="toc-number">3.3.3.3.</span> <span class="toc-text">OpenLayers默认使用的分辨率</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8XYZ%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD%E7%93%A6%E7%89%87%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.4.</span> <span class="toc-text">使用XYZ方式加载瓦片数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8XYZ%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD%E9%AB%98%E5%BE%B7%E7%93%A6%E7%89%87%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.4.1.</span> <span class="toc-text">使用XYZ方式加载高德瓦片数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E4%BD%BF%E7%94%A8XYZ%E6%96%B9%E5%BC%8F%E5%8A%A0%E8%BD%BD%E9%9B%85%E8%99%8E%E5%9C%B0%E5%9B%BE"><span class="toc-number">3.3.4.2.</span> <span class="toc-text">使用XYZ方式加载雅虎地图</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#OpenLayers%E4%BF%AE%E6%94%B9%E7%93%A6%E7%89%87%E5%9D%90%E6%A0%87%E7%B3%BB%E5%8F%8A%E5%88%86%E8%BE%A8%E7%8E%87"><span class="toc-number">3.3.5.</span> <span class="toc-text">OpenLayers修改瓦片坐标系及分辨率</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#OpenLayers%E4%B8%AD%E5%AE%9A%E4%B9%89%E7%93%A6%E7%89%87%E5%9D%90%E6%A0%87%E7%B3%BB%E7%9A%84%E6%8E%A5%E5%8F%A3"><span class="toc-number">3.3.5.1.</span> <span class="toc-text">OpenLayers中定义瓦片坐标系的接口</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E8%87%AA%E5%AE%9A%E4%B9%89OpenLayers%E7%93%A6%E7%89%87%E5%9D%90%E6%A0%87%E7%B3%BB%E6%9D%A5%E5%8A%A0%E8%BD%BD%E7%99%BE%E5%BA%A6%E5%9C%B0%E5%9B%BE"><span class="toc-number">3.3.5.2.</span> <span class="toc-text">自定义OpenLayers瓦片坐标系来加载百度地图</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%88%86%E6%9E%90%E7%93%A6%E7%89%87%E5%9C%B0%E5%9B%BE%E7%9A%84%E7%93%A6%E7%89%87%E5%9D%90%E6%A0%87%E7%B3%BB"><span class="toc-number">3.3.5.3.</span> <span class="toc-text">分析瓦片地图的瓦片坐标系</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BD%E5%BE%AE%E8%BD%AFbing%E4%B8%AD%E6%96%87%E5%9C%B0%E5%9B%BE"><span class="toc-number">3.3.5.3.1.</span> <span class="toc-text">加载微软bing中文地图</span></a></li><li class="toc-item toc-level-5"><a class="toc-link"><span class="toc-number">3.3.5.3.2.</span> <span class="toc-text"></span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#%E5%8A%A0%E8%BD%BDGoogle%E4%B8%AD%E6%96%87%E5%9C%B0%E5%9B%BE"><span class="toc-number">3.3.5.3.3.</span> <span class="toc-text">加载Google中文地图</span></a></li></ol></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%8F%AF%E9%87%8D%E7%94%A8%E6%95%B0%E6%8D%AE%E6%BA%90"><span class="toc-number">3.3.6.</span> <span class="toc-text">可重用数据源</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E7%9F%A2%E9%87%8F%E5%9C%B0%E5%9B%BE"><span class="toc-number">3.3.7.</span> <span class="toc-text">矢量地图</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E7%AE%80%E4%BB%8B-1"><span class="toc-number">3.3.7.1.</span> <span class="toc-text">简介</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E5%9C%A8OpenLaters%E4%B8%AD%E7%9B%B4%E6%8E%A5%E7%BB%84%E7%BB%87%E7%9F%A2%E9%87%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.7.2.</span> <span class="toc-text">在OpenLaters中直接组织矢量数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#url%E8%AF%B7%E6%B1%82%E7%9F%A2%E9%87%8F%E6%95%B0%E6%8D%AE"><span class="toc-number">3.3.7.3.</span> <span class="toc-text">url请求矢量数据</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%A0%B7%E5%BC%8F%E8%AE%BE%E7%BD%AE"><span class="toc-number">3.3.7.4.</span> <span class="toc-text">样式设置</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#API"><span class="toc-number">4.</span> <span class="toc-text">API</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#map%EF%BC%88%E5%9C%B0%E5%9B%BE%EF%BC%89"><span class="toc-number">4.1.</span> <span class="toc-text">map（地图）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%88%9B%E5%BB%BA%E5%9F%BA%E6%9C%AC%E5%9C%B0%E5%9B%BE"><span class="toc-number">4.1.1.</span> <span class="toc-text">创建基本地图</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%B1%9E%E6%80%A7%E9%80%89%E9%A1%B9"><span class="toc-number">4.1.2.</span> <span class="toc-text">属性选项</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#%E5%9C%B0%E5%9B%BE%E4%BA%8B%E4%BB%B6"><span class="toc-number">4.1.3.</span> <span class="toc-text">地图事件</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#map%E7%9A%84%E6%96%B9%E6%B3%95"><span class="toc-number">4.1.4.</span> <span class="toc-text">map的方法</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Layers%EF%BC%88%E5%9B%BE%E5%B1%82%EF%BC%89"><span class="toc-number">4.2.</span> <span class="toc-text">Layers（图层）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-ol-layer-Tile"><span class="toc-number">4.2.1.</span> <span class="toc-text">(1)ol.layer.Tile()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2-ol-layer-Image"><span class="toc-number">4.2.2.</span> <span class="toc-text">(2)ol.layer.Image()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-ol-layer-Vector"><span class="toc-number">4.2.3.</span> <span class="toc-text">(3)ol.layer.Vector()</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-Feature"><span class="toc-number">4.2.3.1.</span> <span class="toc-text">1)Feature</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-Style"><span class="toc-number">4.2.3.2.</span> <span class="toc-text">2)Style</span></a><ol class="toc-child"><li class="toc-item toc-level-5"><a class="toc-link" href="#1%EF%BC%89ol-geom-Circle"><span class="toc-number">4.2.3.2.1.</span> <span class="toc-text">1）ol.geom.Circle()</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#2%EF%BC%89ol-geom-LineString-coordinates-opt-layout"><span class="toc-number">4.2.3.2.2.</span> <span class="toc-text">2）ol.geom.LineString(coordinates, opt_layout)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#3%EF%BC%89-ol-geom-Point-coordinates-opt-layout"><span class="toc-number">4.2.3.2.3.</span> <span class="toc-text">3）)ol.geom.Point(coordinates, opt_layout)</span></a></li><li class="toc-item toc-level-5"><a class="toc-link" href="#4%EF%BC%89ol-layer-VectorTile"><span class="toc-number">4.2.3.2.4.</span> <span class="toc-text">4）ol.layer.VectorTile()</span></a></li></ol></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#view%EF%BC%88%E8%A7%86%E5%9B%BE%EF%BC%89"><span class="toc-number">4.3.</span> <span class="toc-text">view（视图）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1-%E8%A7%86%E5%9B%BE%E9%80%89%E9%A1%B9"><span class="toc-number">4.3.1.</span> <span class="toc-text">1)视图选项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E4%B8%AD%E5%BF%83%E7%82%B9center"><span class="toc-number">4.3.1.1.</span> <span class="toc-text">1）中心点center</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E6%8A%95%E5%BD%B1projection"><span class="toc-number">4.3.1.2.</span> <span class="toc-text">2）投影projection</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%88%86%E8%BE%A8%E7%8E%87resolution"><span class="toc-number">4.3.1.3.</span> <span class="toc-text">3）分辨率resolution</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E6%97%8B%E8%BD%ACrotation"><span class="toc-number">4.3.1.4.</span> <span class="toc-text">4）旋转rotation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-%E7%BC%A9%E6%94%BEzoom"><span class="toc-number">4.3.1.5.</span> <span class="toc-text">5)缩放zoom</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-%E6%97%8B%E8%BD%AC%E7%BA%A6%E6%9D%9FconstrainRotation"><span class="toc-number">4.3.1.6.</span> <span class="toc-text">6)旋转约束constrainRotation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-%E5%90%AF%E7%94%A8%E6%97%8B%E8%BD%ACenableRotation"><span class="toc-number">4.3.1.7.</span> <span class="toc-text">7)启用旋转enableRotation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-%E7%BA%A6%E6%9D%9F%E8%8C%83%E5%9B%B4extent"><span class="toc-number">4.3.1.8.</span> <span class="toc-text">8)约束范围extent</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E8%A7%86%E5%9B%BE%E6%96%B9%E6%B3%95"><span class="toc-number">4.3.2.</span> <span class="toc-text">2）视图方法</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E5%8A%A8%E7%94%BB"><span class="toc-number">4.3.2.1.</span> <span class="toc-text">1）动画</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E5%8F%96%E6%B6%88%E5%8A%A8%E7%94%BBcancelAnimations"><span class="toc-number">4.3.2.2.</span> <span class="toc-text">2）取消动画cancelAnimations()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89getAnimating"><span class="toc-number">4.3.2.3.</span> <span class="toc-text">3）getAnimating()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E8%AE%A1%E7%AE%97%E8%8C%83%E5%9B%B4calculateExtent-opt-size"><span class="toc-number">4.3.2.4.</span> <span class="toc-text">4）计算范围calculateExtent(opt_size)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89centerOn-coordinate-size-position"><span class="toc-number">4.3.2.5.</span> <span class="toc-text">5）centerOn(coordinate, size, position)</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#interaction-%E4%BA%A4%E4%BA%92"><span class="toc-number">4.4.</span> <span class="toc-text">interaction(交互)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E9%BB%98%E8%AE%A4%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BDol-interaction-defaylts"><span class="toc-number">4.4.1.</span> <span class="toc-text">1）默认交互功能ol.interaction.defaylts()</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#2%EF%BC%89%E9%92%88%E5%AF%B9%E7%9F%A2%E9%87%8F%E5%9B%BE%E5%B1%82%E5%85%83%E7%B4%A0%E7%9A%84%E4%BA%A4%E4%BA%92%E5%8A%9F%E8%83%BD"><span class="toc-number">4.4.2.</span> <span class="toc-text">2）针对矢量图层元素的交互功能</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E9%80%89%E6%8B%A9ol-interaction-Select"><span class="toc-number">4.4.2.1.</span> <span class="toc-text">1）选择ol.interaction.Select()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E7%BB%98%E5%88%B6ol-interaction-Draw"><span class="toc-number">4.4.2.2.</span> <span class="toc-text">2）绘制ol.interaction.Draw()</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-%E4%BF%AE%E6%94%B9ol-interaction-Modify"><span class="toc-number">4.4.2.3.</span> <span class="toc-text">3)修改ol.interaction.Modify()</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#controler-%E6%8E%A7%E4%BB%B6"><span class="toc-number">4.5.</span> <span class="toc-text">controler(控件)</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#overlay-%E5%8F%A0%E5%8A%A0%E5%B1%82"><span class="toc-number">4.6.</span> <span class="toc-text">overlay(叠加层)</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Overlay%E9%80%89%E9%A1%B9"><span class="toc-number">4.6.1.</span> <span class="toc-text">Overlay选项</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1-id"><span class="toc-number">4.6.1.1.</span> <span class="toc-text">(1)id</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-element"><span class="toc-number">4.6.1.2.</span> <span class="toc-text">(2)element</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3-offset"><span class="toc-number">4.6.1.3.</span> <span class="toc-text">(3)offset</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-position"><span class="toc-number">4.6.1.4.</span> <span class="toc-text">(4)position</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-positioning"><span class="toc-number">4.6.1.5.</span> <span class="toc-text">(5)positioning</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-autoPan"><span class="toc-number">4.6.1.6.</span> <span class="toc-text">(6)autoPan</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-autoPanAnimation"><span class="toc-number">4.6.1.7.</span> <span class="toc-text">(7)autoPanAnimation</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-stopEvent"><span class="toc-number">4.6.1.8.</span> <span class="toc-text">(8)stopEvent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-className"><span class="toc-number">4.6.1.9.</span> <span class="toc-text">(9)className</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-autoPanMargin"><span class="toc-number">4.6.1.10.</span> <span class="toc-text">(10)autoPanMargin</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#Projections%EF%BC%88%E6%8A%95%E5%BD%B1%EF%BC%89"><span class="toc-number">4.7.</span> <span class="toc-text">Projections（投影）</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#1%EF%BC%89%E3%80%81ol-proj"><span class="toc-number">4.7.1.</span> <span class="toc-text">(1）、ol.proj</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89ol-proj-addCoordinateTransforms-source-destination-forward-inverse"><span class="toc-number">4.7.1.1.</span> <span class="toc-text">1）ol.proj.addCoordinateTransforms(source, destination, forward, inverse)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2-ol-proj-addEquivalentProjections-projections"><span class="toc-number">4.7.1.2.</span> <span class="toc-text">2)ol.proj.addEquivalentProjections(projections)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89ol-proj-addProjection-projection"><span class="toc-number">4.7.1.3.</span> <span class="toc-text">3）ol.proj.addProjection(projection)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4-ol-proj-equivalent-projection1-projection2"><span class="toc-number">4.7.1.4.</span> <span class="toc-text">4)ol.proj.equivalent(projection1, projection2)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5-ol-proj-fromLonLat-coordinate-opt-projection"><span class="toc-number">4.7.1.5.</span> <span class="toc-text">5)ol.proj.fromLonLat(coordinate, opt_projection)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6-ol-proj-get-projectionLike"><span class="toc-number">4.7.1.6.</span> <span class="toc-text">6)ol.proj.get(projectionLike)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7-ol-proj-getTransform-source-destination"><span class="toc-number">4.7.1.7.</span> <span class="toc-text">7)ol.proj.getTransform(source, destination)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8-ol-proj-setProj4-proj4"><span class="toc-number">4.7.1.8.</span> <span class="toc-text">8)ol.proj.setProj4(proj4)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9-ol-proj-toLonLat-coordinate-opt-projection"><span class="toc-number">4.7.1.9.</span> <span class="toc-text">9)ol.proj.toLonLat(coordinate, opt_projection)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10-ol-proj-transform-coordinate-source-destination"><span class="toc-number">4.7.1.10.</span> <span class="toc-text">10)ol.proj.transform(coordinate, source, destination)</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11-ol-proj-transformExtent"><span class="toc-number">4.7.1.11.</span> <span class="toc-text">11)ol.proj.transformExtent</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#12-ol-proj-Units-string"><span class="toc-number">4.7.1.12.</span> <span class="toc-text">12)ol.proj.Units&amp;#123;string&amp;#125;</span></a></li></ol></li></ol></li></ol></li></ol></div></div></div><div class="card-widget card-recent-post"><div class="card-content"><div class="item-headline"><i class="fas fa-history"></i><span>Recent Post</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2022/07/27/PgSql%E8%8E%B7%E5%8F%96json%E6%A0%BC%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E6%9F%90%E4%B8%AA%E5%B1%9E%E6%80%A7%E7%9A%84%E5%80%BC/" title="PgSql获取json格式字符串中某个属性的值"><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210401115543.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="PgSql获取json格式字符串中某个属性的值"/></a><div class="content"><a class="title" href="/2022/07/27/PgSql%E8%8E%B7%E5%8F%96json%E6%A0%BC%E5%BC%8F%E5%AD%97%E7%AC%A6%E4%B8%B2%E4%B8%AD%E6%9F%90%E4%B8%AA%E5%B1%9E%E6%80%A7%E7%9A%84%E5%80%BC/" title="PgSql获取json格式字符串中某个属性的值">PgSql获取json格式字符串中某个属性的值</a><time datetime="2022-07-27T02:28:39.864Z" title="Created 2022-07-27 10:28:39">2022-07-27</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2022/03/25/Mybatis-%E6%89%B9%E9%87%8F%E5%A4%84%E7%90%86/" title="MyBatis-批量处理"><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210401115535.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MyBatis-批量处理"/></a><div class="content"><a class="title" href="/2022/03/25/Mybatis-%E6%89%B9%E9%87%8F%E5%A4%84%E7%90%86/" title="MyBatis-批量处理">MyBatis-批量处理</a><time datetime="2022-03-25T03:17:21.963Z" title="Created 2022-03-25 11:17:21">2022-03-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/10/22/jvm/" title="No title"><img src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/img/default.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="No title"/></a><div class="content"><a class="title" href="/2021/10/22/jvm/" title="No title">No title</a><time datetime="2021-10-22T09:42:25.080Z" title="Created 2021-10-22 17:42:25">2021-10-22</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/30/typeScript/" title="TypeScript"><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20211019161458.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="TypeScript"/></a><div class="content"><a class="title" href="/2021/09/30/typeScript/" title="TypeScript">TypeScript</a><time datetime="2021-09-30T06:28:35.678Z" title="Created 2021-09-30 14:28:35">2021-09-30</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2021/09/22/OpenLayers/" title="OpenLayers"><img src="https://heavenimmortal.oss-cn-chengdu.aliyuncs.com/img/20210922152509.png" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="OpenLayers"/></a><div class="content"><a class="title" href="/2021/09/22/OpenLayers/" title="OpenLayers">OpenLayers</a><time datetime="2021-09-22T06:27:41.751Z" title="Created 2021-09-22 14:27:41">2021-09-22</time></div></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2020 - 2022 By HeavenImmortal</div><div class="framework-info"><span>Framework </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>Theme </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">广修亿劫，证吾神通!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="Read Mode"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="Switch Between Traditional Chinese And Simplified Chinese">简</button><button id="darkmode" type="button" title="Switch Between Light And Dark Mode"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="Setting"><i class="fas fa-cog"></i></button><button class="close" id="mobile-toc-button" type="button" title="Table Of Contents"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="Back To Top"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">Local search</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="Search for Posts" type="text"/></div></div></div><hr/><div id="local-search-results"><div id="local-hits"></div><div id="local-stats"><div class="local-search-stats__hr" id="hr"><span>Powered by</span> <a target="_blank" rel="noopener" href="https://github.com/wzpan/hexo-generator-search" style="color:#49B1F5;">hexo-generator-search</a></div></div></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script src="/js/search/local-search.js"></script><script>var preloader = {
  endLoading: () => {
    document.body.style.overflow = 'auto';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.remove("loaded")

  }
}
window.addEventListener('load',()=> {preloader.endLoading()})</script><div class="js-pjax"><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div><script src="/css/mine.js"></script></div></body></html>